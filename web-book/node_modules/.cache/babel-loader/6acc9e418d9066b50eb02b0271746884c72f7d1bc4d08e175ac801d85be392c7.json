{"ast":null,"code":"import { formatDate } from '@/store/formatDate';\nexport default {\n  data() {\n    return {\n      currentUserId: null,\n      // 当前登录用户ID\n      loginStatus: false,\n      // 登录状态\n      loading: false,\n      form: {\n        content: ''\n      },\n      messages: [],\n      page: {\n        pageNum: 1,\n        pageSize: 5\n      },\n      total: 0\n    };\n  },\n  mounted() {\n    this.checkLoginStatus();\n    this.loadData();\n  },\n  methods: {\n    formatTime(time) {\n      if (!time) return \"暂无时间信息\";\n      try {\n        const dateStr = typeof time === \"string\" ? time : time.toString();\n        return formatDate(new Date(dateStr), \"yyyy-MM-dd hh:mm:ss\");\n      } catch (e) {\n        console.error(\"时间格式错误:\", time);\n        return \"时间格式异常\";\n      }\n    },\n    async loadData() {\n      this.loading = true;\n      try {\n        const res = await this.$axios.post(this.$httpUrl + '/guestbook/user/list', this.page);\n        if (res.data.code === 200) {\n          this.messages = res.data.data;\n          this.total = res.data.total;\n        }\n      } catch (error) {\n        this.$message.error(\"获取留言失败\");\n      } finally {\n        this.loading = false;\n      }\n    },\n    async submit() {\n      if (!this.form.content.trim()) {\n        this.$message.warning(\"留言内容不能为空哦~\");\n        return;\n      }\n      try {\n        const res = await this.$axios.post(this.$httpUrl + '/guestbook/submit', this.form);\n        if (res.data.code === 200) {\n          this.$message.success({\n            message: '留言成功！店长会尽快回复~',\n            iconClass: 'el-icon-success'\n          });\n          this.form.content = '';\n          this.loadData();\n        }\n      } catch (error) {\n        this.$message.error(\"提交留言失败\");\n      }\n    },\n    checkLoginStatus() {\n      const userData = sessionStorage.getItem('CurUser');\n      if (userData) {\n        try {\n          const user = JSON.parse(userData);\n          this.currentUserId = user.id;\n          this.loginStatus = true;\n        } catch (e) {\n          console.error('用户信息解析失败:', e);\n        }\n      }\n    },\n    handleDelete(id) {\n      this.$confirm('确定要删除这条留言吗？', '删除确认', {\n        confirmButtonText: '确定删除',\n        cancelButtonText: '再想想',\n        type: 'warning',\n        customClass: 'delete-dialog',\n        confirmButtonClass: 'el-button--danger',\n        cancelButtonClass: 'el-button--primary'\n      }).then(async () => {\n        try {\n          const res = await this.$axios.get(this.$httpUrl + '/announcement/delete', {\n            params: {\n              id\n            }\n          });\n          if (res.data.code === 200) {\n            this.$message.success({\n              message: '删除成功',\n              iconClass: 'el-icon-success'\n            });\n            // 重新加载数据\n            this.loadData();\n          }\n        } catch (error) {\n          this.$message.error('删除失败，请稍后重试');\n        }\n      }).catch(() => {});\n    },\n    handlePageChange(val) {\n      this.page.pageNum = val;\n      this.loadData();\n    }\n  }\n};","map":{"version":3,"names":["formatDate","data","currentUserId","loginStatus","loading","form","content","messages","page","pageNum","pageSize","total","mounted","checkLoginStatus","loadData","methods","formatTime","time","dateStr","toString","Date","e","console","error","res","$axios","post","$httpUrl","code","$message","submit","trim","warning","success","message","iconClass","userData","sessionStorage","getItem","user","JSON","parse","id","handleDelete","$confirm","confirmButtonText","cancelButtonText","type","customClass","confirmButtonClass","cancelButtonClass","then","get","params","catch","handlePageChange","val"],"sources":["src/user/GuestbookPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"guestbook-container\">\r\n    <el-card class=\"book-style-card\">\r\n      <!-- 卡片头部 -->\r\n      <div slot=\"header\" class=\"card-header\">\r\n        <div class=\"title-wrapper\">\r\n          <i class=\"el-icon-notebook-2 header-icon\"></i>\r\n          <span class=\"card-title\">读者留言板</span>\r\n        </div>\r\n        <div class=\"decorative-line\"></div>\r\n      </div>\r\n\r\n      <!-- 留言输入区 -->\r\n      <div class=\"message-input-area\">\r\n        <el-form @submit.native.prevent=\"submit\">\r\n          <el-form-item>\r\n            <el-input\r\n                type=\"textarea\"\r\n                v-model=\"form.content\"\r\n                :rows=\"4\"\r\n                placeholder=\"写下您的阅读感悟、书籍建议或任何想对我们说的话...\"\r\n                maxlength=\"500\"\r\n                show-word-limit\r\n                class=\"parchment-input\"\r\n                resize=\"none\"\r\n            >\r\n              <i slot=\"prefix\" class=\"el-icon-edit pen-icon\"></i>\r\n            </el-input>\r\n          </el-form-item>\r\n          <el-form-item>\r\n            <el-button\r\n                type=\"primary\"\r\n                native-type=\"submit\"\r\n                class=\"submit-btn\"\r\n            >\r\n              <i class=\"el-icon-s-promotion btn-icon\"></i>\r\n              提交留言\r\n            </el-button>\r\n          </el-form-item>\r\n        </el-form>\r\n      </div>\r\n\r\n      <!-- 留言列表 -->\r\n      <div class=\"message-list\">\r\n        <el-divider class=\"vintage-divider\">\r\n          <i class=\"el-icon-collection-tag\"></i>\r\n          历史留言\r\n        </el-divider>\r\n\r\n        <el-table\r\n            :data=\"messages\"\r\n            v-loading=\"loading\"\r\n            style=\"width: 100%\"\r\n            class=\"book-table\"\r\n            empty-text=\"暂无留言，快来留下第一个书评吧~\"\r\n        >\r\n          <el-table-column label=\"留言时间\" width=\"180\" align=\"center\">\r\n            <template slot-scope=\"{row}\">\r\n              <div class=\"time-cell\">\r\n                <i class=\"el-icon-time time-icon\"></i>\r\n                {{ formatTime(row.createTime) }}\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"留言内容\" min-width=\"300\">\r\n            <template slot-scope=\"{row}\">\r\n              <div class=\"content-cell\">\r\n                <div class=\"quote-mark left\">“</div>\r\n                <div class=\"content-text\">{{ row.content }}</div>\r\n                <div class=\"quote-mark right\">”</div>\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"店长回复\" width=\"280\" align=\"center\">\r\n            <template slot-scope=\"{row}\">\r\n              <div v-if=\"row.adminReply\" class=\"reply-cell\">\r\n                <div class=\"admin-label\">\r\n                  <i class=\"el-icon-user-solid\"></i>\r\n                  店长回复\r\n                </div>\r\n                <div class=\"reply-content\">{{ row.adminReply }}</div>\r\n                <div class=\"reply-time\">{{ formatTime(row.updateTime) }}</div>\r\n              </div>\r\n              <div v-else class=\"no-reply\">\r\n                <i class=\"el-icon-coffee-cup\"></i>\r\n                等待店长泡咖啡时回复...\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column\r\n              label=\"操作\"\r\n              width=\"120\"\r\n              align=\"center\"\r\n              v-if=\"loginStatus\"\r\n          >\r\n            <template slot-scope=\"{row}\">\r\n              <el-button\r\n                  v-if=\"row.userId === currentUserId\"\r\n                  type=\"danger\"\r\n                  icon=\"el-icon-delete\"\r\n                  circle\r\n                  @click=\"handleDelete(row.id)\"\r\n                  class=\"delete-btn\"\r\n              ></el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n\r\n        <!-- 分页 -->\r\n        <el-pagination\r\n            class=\"book-pagination\"\r\n            @current-change=\"handlePageChange\"\r\n            :current-page=\"page.pageNum\"\r\n            :page-size=\"page.pageSize\"\r\n            :total=\"total\"\r\n            layout=\"prev, pager, next\"\r\n            prev-text=\"上一页\"\r\n            next-text=\"下一页\"\r\n        ></el-pagination>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { formatDate } from '@/store/formatDate';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      currentUserId: null,   // 当前登录用户ID\r\n      loginStatus: false,    // 登录状态\r\n      loading: false,\r\n      form: { content: '' },\r\n      messages: [],\r\n      page: { pageNum: 1, pageSize: 5 },\r\n      total: 0\r\n    }\r\n  },\r\n  mounted() {\r\n    this.checkLoginStatus();\r\n    this.loadData()\r\n  },\r\n  methods: {\r\n    formatTime(time) {\r\n      if (!time) return \"暂无时间信息\";\r\n      try {\r\n        const dateStr = typeof time === \"string\" ? time : time.toString();\r\n        return formatDate(new Date(dateStr), \"yyyy-MM-dd hh:mm:ss\");\r\n      } catch (e) {\r\n        console.error(\"时间格式错误:\", time);\r\n        return \"时间格式异常\";\r\n      }\r\n    },\r\n    async loadData() {\r\n      this.loading = true;\r\n      try {\r\n        const res = await this.$axios.post(\r\n            this.$httpUrl+'/guestbook/user/list',\r\n            this.page\r\n        );\r\n        if(res.data.code === 200) {\r\n          this.messages = res.data.data;\r\n          this.total = res.data.total;\r\n        }\r\n      } catch (error) {\r\n        this.$message.error(\"获取留言失败\");\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    async submit() {\r\n      if (!this.form.content.trim()) {\r\n        this.$message.warning(\"留言内容不能为空哦~\");\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const res = await this.$axios.post(\r\n            this.$httpUrl+'/guestbook/submit',\r\n            this.form\r\n        );\r\n        if(res.data.code === 200) {\r\n          this.$message.success({\r\n            message: '留言成功！店长会尽快回复~',\r\n            iconClass: 'el-icon-success'\r\n          });\r\n          this.form.content = '';\r\n          this.loadData();\r\n        }\r\n      } catch (error) {\r\n        this.$message.error(\"提交留言失败\");\r\n      }\r\n    },\r\n    checkLoginStatus() {\r\n      const userData = sessionStorage.getItem('CurUser');\r\n      if (userData) {\r\n        try {\r\n          const user = JSON.parse(userData);\r\n          this.currentUserId = user.id;\r\n          this.loginStatus = true;\r\n        } catch (e) {\r\n          console.error('用户信息解析失败:', e);\r\n        }\r\n      }\r\n    },\r\n    handleDelete(id) {\r\n      this.$confirm('确定要删除这条留言吗？', '删除确认', {\r\n        confirmButtonText: '确定删除',\r\n        cancelButtonText: '再想想',\r\n        type: 'warning',\r\n        customClass: 'delete-dialog',\r\n        confirmButtonClass: 'el-button--danger',\r\n        cancelButtonClass: 'el-button--primary'\r\n      }).then(async () => {\r\n        try {\r\n          const res = await this.$axios.get(this.$httpUrl+'/announcement/delete', {\r\n            params: { id }\r\n          });\r\n          if(res.data.code === 200) {\r\n            this.$message.success({\r\n              message: '删除成功',\r\n              iconClass: 'el-icon-success'\r\n            });\r\n            // 重新加载数据\r\n            this.loadData();\r\n          }\r\n        } catch (error) {\r\n          this.$message.error('删除失败，请稍后重试');\r\n        }\r\n      }).catch(() => {});\r\n    },\r\n    handlePageChange(val) {\r\n      this.page.pageNum = val;\r\n      this.loadData();\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.guestbook-container {\r\n  padding: 30px;\r\n  min-height: calc(100vh - 60px);\r\n\r\n  .book-style-card {\r\n    border-radius: 12px;\r\n    box-shadow: 0 8px 32px rgba(94, 73, 62, 0.15);\r\n    border: none;\r\n\r\n    .card-header {\r\n      .title-wrapper {\r\n        display: flex;\r\n        align-items: center;\r\n        margin-bottom: 12px;\r\n\r\n        .header-icon {\r\n          font-size: 28px;\r\n          color: #8b572a;\r\n          margin-right: 12px;\r\n        }\r\n\r\n        .card-title {\r\n          font-size: 24px;\r\n          font-family: 'Microsoft YaHei', cursive;\r\n          color: #4a3527;\r\n          letter-spacing: 2px;\r\n        }\r\n      }\r\n\r\n      .decorative-line {\r\n        height: 2px;\r\n        background: linear-gradient(90deg, transparent, #d4c8b8, transparent);\r\n      }\r\n    }\r\n\r\n    .message-input-area {\r\n      margin: 24px 0;\r\n\r\n      .parchment-input {\r\n        ::v-deep .el-textarea__inner {\r\n          background: #fff9f0;\r\n          border: 1px solid #e5d5c3;\r\n          border-radius: 8px;\r\n          padding: 16px 20px;\r\n          font-size: 15px;\r\n          color: #66594d;\r\n          box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);\r\n\r\n          &::placeholder {\r\n            color: #b8a795;\r\n          }\r\n        }\r\n\r\n        .pen-icon {\r\n          font-size: 20px;\r\n          color: #8b572a;\r\n          margin: 10px;\r\n        }\r\n      }\r\n\r\n      .submit-btn {\r\n        background: linear-gradient(135deg, #8b572a, #6d4221);\r\n        border: none;\r\n        border-radius: 24px;\r\n        padding: 12px 36px;\r\n        font-size: 16px;\r\n        letter-spacing: 2px;\r\n        transition: all 0.3s;\r\n\r\n        &:hover {\r\n          transform: translateY(-2px);\r\n          box-shadow: 0 4px 12px rgba(139, 87, 42, 0.3);\r\n        }\r\n\r\n        .btn-icon {\r\n          margin-right: 8px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .message-list {\r\n      .vintage-divider {\r\n        ::v-deep .el-divider__text {\r\n          background: #f5efe9;\r\n          color: #6d4221;\r\n          font-size: 16px;\r\n          padding: 0 20px;\r\n\r\n          i {\r\n            margin-right: 8px;\r\n          }\r\n        }\r\n      }\r\n\r\n      .book-table {\r\n        margin: 20px 0;\r\n\r\n        .time-cell {\r\n          color: #8b572a;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n\r\n          .time-icon {\r\n            margin-right: 6px;\r\n            font-size: 16px;\r\n          }\r\n        }\r\n\r\n        .content-cell {\r\n          position: relative;\r\n          padding: 12px;\r\n          background: #fbf6f0;\r\n          border-radius: 6px;\r\n\r\n          .quote-mark {\r\n            position: absolute;\r\n            color: #d4c8b8;\r\n            font-size: 32px;\r\n            font-family: serif;\r\n            &.left { left: 8px; top: -8px; }\r\n            &.right { right: 8px; bottom: -12px; }\r\n          }\r\n\r\n          .content-text {\r\n            line-height: 1.8;\r\n            color: #66594d;\r\n          }\r\n        }\r\n\r\n        .reply-cell {\r\n          background: #f0f5ff;\r\n          border-radius: 6px;\r\n          padding: 12px;\r\n          border-left: 3px solid #8b572a;\r\n\r\n          .admin-label {\r\n            color: #8b572a;\r\n            font-size: 12px;\r\n            margin-bottom: 6px;\r\n\r\n            i {\r\n              margin-right: 4px;\r\n            }\r\n          }\r\n\r\n          .reply-content {\r\n            color: #4a4a4a;\r\n            line-height: 1.6;\r\n          }\r\n\r\n          .reply-time {\r\n            color: #999;\r\n            font-size: 12px;\r\n            margin-top: 6px;\r\n          }\r\n        }\r\n\r\n        .no-reply {\r\n          color: #b8a795;\r\n          font-style: italic;\r\n          padding: 8px;\r\n\r\n          i {\r\n            margin-right: 6px;\r\n          }\r\n        }\r\n      }\r\n\r\n      .book-pagination {\r\n        margin-top: 24px;\r\n        ::v-deep .btn-prev,\r\n        ::v-deep .btn-next {\r\n          background: #f5efe9 !important;\r\n          border-radius: 4px;\r\n          padding: 0 12px;\r\n        }\r\n\r\n        ::v-deep .el-pager li {\r\n          background: #f5efe9;\r\n          border-radius: 4px;\r\n          margin: 0 4px;\r\n          &.active {\r\n            background: #8b572a;\r\n            color: white;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n.delete-btn {\r\n  transform: scale(0.8);\r\n  transition: all 0.3s ease;\r\n\r\n  &:hover {\r\n    transform: scale(1);\r\n    box-shadow: 0 2px 6px rgba(255, 73, 73, 0.3);\r\n  }\r\n\r\n  &:active {\r\n    transform: scale(0.9);\r\n  }\r\n}\r\n\r\n::v-deep .delete-dialog {\r\n  .el-message-box__headerbtn {\r\n    &:hover .el-icon-close {\r\n      color: #ff4949;\r\n    }\r\n  }\r\n\r\n  .el-message-box__btns {\r\n    .el-button--danger {\r\n      background: linear-gradient(135deg, #ff4949, #d93636);\r\n      border: none;\r\n      &:hover {\r\n        opacity: 0.9;\r\n      }\r\n    }\r\n\r\n    .el-button--primary {\r\n      background: linear-gradient(135deg, #8b572a, #6d4221);\r\n      border: none;\r\n    }\r\n  }\r\n}\r\n</style>"],"mappings":"AAgIA,SAAAA,UAAA;AAEA;EACAC,KAAA;IACA;MACAC,aAAA;MAAA;MACAC,WAAA;MAAA;MACAC,OAAA;MACAC,IAAA;QAAAC,OAAA;MAAA;MACAC,QAAA;MACAC,IAAA;QAAAC,OAAA;QAAAC,QAAA;MAAA;MACAC,KAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,gBAAA;IACA,KAAAC,QAAA;EACA;EACAC,OAAA;IACAC,WAAAC,IAAA;MACA,KAAAA,IAAA;MACA;QACA,MAAAC,OAAA,UAAAD,IAAA,gBAAAA,IAAA,GAAAA,IAAA,CAAAE,QAAA;QACA,OAAAnB,UAAA,KAAAoB,IAAA,CAAAF,OAAA;MACA,SAAAG,CAAA;QACAC,OAAA,CAAAC,KAAA,YAAAN,IAAA;QACA;MACA;IACA;IACA,MAAAH,SAAA;MACA,KAAAV,OAAA;MACA;QACA,MAAAoB,GAAA,cAAAC,MAAA,CAAAC,IAAA,CACA,KAAAC,QAAA,2BACA,KAAAnB,IACA;QACA,IAAAgB,GAAA,CAAAvB,IAAA,CAAA2B,IAAA;UACA,KAAArB,QAAA,GAAAiB,GAAA,CAAAvB,IAAA,CAAAA,IAAA;UACA,KAAAU,KAAA,GAAAa,GAAA,CAAAvB,IAAA,CAAAU,KAAA;QACA;MACA,SAAAY,KAAA;QACA,KAAAM,QAAA,CAAAN,KAAA;MACA;QACA,KAAAnB,OAAA;MACA;IACA;IACA,MAAA0B,OAAA;MACA,UAAAzB,IAAA,CAAAC,OAAA,CAAAyB,IAAA;QACA,KAAAF,QAAA,CAAAG,OAAA;QACA;MACA;MAEA;QACA,MAAAR,GAAA,cAAAC,MAAA,CAAAC,IAAA,CACA,KAAAC,QAAA,wBACA,KAAAtB,IACA;QACA,IAAAmB,GAAA,CAAAvB,IAAA,CAAA2B,IAAA;UACA,KAAAC,QAAA,CAAAI,OAAA;YACAC,OAAA;YACAC,SAAA;UACA;UACA,KAAA9B,IAAA,CAAAC,OAAA;UACA,KAAAQ,QAAA;QACA;MACA,SAAAS,KAAA;QACA,KAAAM,QAAA,CAAAN,KAAA;MACA;IACA;IACAV,iBAAA;MACA,MAAAuB,QAAA,GAAAC,cAAA,CAAAC,OAAA;MACA,IAAAF,QAAA;QACA;UACA,MAAAG,IAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAL,QAAA;UACA,KAAAlC,aAAA,GAAAqC,IAAA,CAAAG,EAAA;UACA,KAAAvC,WAAA;QACA,SAAAkB,CAAA;UACAC,OAAA,CAAAC,KAAA,cAAAF,CAAA;QACA;MACA;IACA;IACAsB,aAAAD,EAAA;MACA,KAAAE,QAAA;QACAC,iBAAA;QACAC,gBAAA;QACAC,IAAA;QACAC,WAAA;QACAC,kBAAA;QACAC,iBAAA;MACA,GAAAC,IAAA;QACA;UACA,MAAA3B,GAAA,cAAAC,MAAA,CAAA2B,GAAA,MAAAzB,QAAA;YACA0B,MAAA;cAAAX;YAAA;UACA;UACA,IAAAlB,GAAA,CAAAvB,IAAA,CAAA2B,IAAA;YACA,KAAAC,QAAA,CAAAI,OAAA;cACAC,OAAA;cACAC,SAAA;YACA;YACA;YACA,KAAArB,QAAA;UACA;QACA,SAAAS,KAAA;UACA,KAAAM,QAAA,CAAAN,KAAA;QACA;MACA,GAAA+B,KAAA;IACA;IACAC,iBAAAC,GAAA;MACA,KAAAhD,IAAA,CAAAC,OAAA,GAAA+C,GAAA;MACA,KAAA1C,QAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}