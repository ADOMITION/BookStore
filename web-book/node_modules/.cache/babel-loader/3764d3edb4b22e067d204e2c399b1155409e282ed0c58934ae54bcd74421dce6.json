{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nexport default {\n  data() {\n    // 手机号验证规则\n    const validatePhone = (rule, value, callback) => {\n      if (!/^1[3-9]\\d{9}$/.test(value)) {\n        callback(new Error('请输入正确的手机号码'));\n      } else {\n        callback();\n      }\n    };\n    return {\n      beijingDistricts: [{\n        value: '东城区',\n        label: '东城区'\n      }, {\n        value: '西城区',\n        label: '西城区'\n      }, {\n        value: '朝阳区',\n        label: '朝阳区'\n      }, {\n        value: '丰台区',\n        label: '丰台区'\n      }, {\n        value: '石景山区',\n        label: '石景山区'\n      }, {\n        value: '海淀区',\n        label: '海淀区'\n      }, {\n        value: '门头沟区',\n        label: '门头沟区'\n      }, {\n        value: '房山区',\n        label: '房山区'\n      }, {\n        value: '通州区',\n        label: '通州区'\n      }, {\n        value: '顺义区',\n        label: '顺义区'\n      }, {\n        value: '昌平区',\n        label: '昌平区'\n      }, {\n        value: '大兴区',\n        label: '大兴区'\n      }, {\n        value: '怀柔区',\n        label: '怀柔区'\n      }, {\n        value: '平谷区',\n        label: '平谷区'\n      }, {\n        value: '密云区',\n        label: '密云区'\n      }, {\n        value: '延庆区',\n        label: '延庆区'\n      }],\n      confirmDataList: [],\n      form: {\n        address: '',\n        recipient: '',\n        tel: '',\n        district: '',\n        detailAddress: '',\n        fullAddress: ''\n      },\n      rules: {\n        address: [{\n          required: true,\n          message: '请输入收货地址',\n          trigger: 'blur'\n        }],\n        recipient: [{\n          required: true,\n          message: '请输入收件人姓名',\n          trigger: 'blur'\n        }],\n        tel: [{\n          required: true,\n          message: '请输入联系方式',\n          trigger: 'blur'\n        }, {\n          validator: validatePhone,\n          trigger: 'blur'\n        }]\n      },\n      total: 0\n    };\n  },\n  created() {\n    this.loadConfirmData();\n  },\n  methods: {\n    updateAddress() {\n      // 更新完整地址\n      this.form.fullAddress = `北京市${this.form.district}${this.form.detailAddress}`;\n\n      // 如果需要将完整地址提交到后端，可以在这里更新form.address\n      this.form.address = this.form.fullAddress;\n    },\n    async loadConfirmData() {\n      try {\n        const type = this.$route.query.type;\n        if (type === 'batch') {\n          const oiids = JSON.parse(this.$route.query.oiids);\n          const {\n            data\n          } = await this.$axios.post(this.$httpUrl + '/order/confirmBatch', {\n            oiids: oiids\n          });\n          if (data.code === 200) {\n            this.confirmDataList = data.data;\n            this.total = data.data.reduce((sum, item) => sum + item.discountPrice * item.orderItem.quantity, 0);\n          }\n        } else {\n          const oiid = this.$route.query.oiid;\n          const {\n            data\n          } = await this.$axios.get(`${this.$httpUrl}/order/confirm?oiid=${oiid}`);\n          if (data.code === 200) {\n            console.log(data.data);\n            this.confirmDataList = [data.data];\n            this.total = data.data.discountPrice * data.data.orderItem.quantity;\n          }\n        }\n      } catch (error) {\n        this.$message.error('获取订单信息失败');\n      }\n    },\n    handleSubmit() {\n      this.$refs.formRef.validate(async valid => {\n        if (valid) {\n          try {\n            const {\n              data\n            } = await this.$axios.post(`${this.$httpUrl}/order/create`, {\n              oiids: this.confirmDataList.map(item => item.orderItem.id),\n              ...this.form\n            });\n            if (data.code === 200) {\n              this.$router.push({\n                path: '/pay',\n                query: {\n                  oid: data.data.oid,\n                  total: data.data.total\n                }\n              });\n            }\n          } catch (error) {\n            this.$message.error('提交订单失败');\n          }\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["data","validatePhone","rule","value","callback","test","Error","beijingDistricts","label","confirmDataList","form","address","recipient","tel","district","detailAddress","fullAddress","rules","required","message","trigger","validator","total","created","loadConfirmData","methods","updateAddress","type","$route","query","oiids","JSON","parse","$axios","post","$httpUrl","code","reduce","sum","item","discountPrice","orderItem","quantity","oiid","get","console","log","error","$message","handleSubmit","$refs","formRef","validate","valid","map","id","$router","push","path","oid"],"sources":["src/user/ConfirmPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"confirm-container\">\r\n    <!-- 头部导航 -->\r\n    <el-steps :active=\"2\" simple class=\"steps\">\r\n      <el-step title=\"首页\" icon=\"el-icon-location-outline\" ></el-step>\r\n      <el-step title=\"确认订单\" icon=\"el-icon-goods\" style=\"margin-right: -20px\"></el-step>\r\n      <el-step title=\"支付\" icon=\"el-icon-wallet\" ></el-step>\r\n      <el-step title=\"完成\" icon=\"el-icon-success\"></el-step>\r\n    </el-steps>\r\n\r\n    <!-- 主体内容 -->\r\n    <div class=\"main-content\">\r\n      <!-- 收货信息 -->\r\n      <el-card class=\"shipping-card\">\r\n        <div slot=\"header\" class=\"card-header\">\r\n          <i class=\"el-icon-location-outline\"></i>\r\n          <span>收货信息</span>\r\n        </div>\r\n        <el-form\r\n            :model=\"form\"\r\n            :rules=\"rules\"\r\n            ref=\"formRef\"\r\n            label-width=\"100px\"\r\n            class=\"shipping-form\"\r\n        >\r\n          <el-form-item label=\"收货地址\" prop=\"address\">\r\n            <div class=\"address-selector\">\r\n              <el-select\r\n                  v-model=\"form.district\"\r\n                  placeholder=\"请选择北京市辖区\"\r\n                  style=\"width: 150px; margin-right: 10px;\"\r\n                  @change=\"updateAddress\"\r\n              >\r\n                <el-option\r\n                    v-for=\"district in beijingDistricts\"\r\n                    :key=\"district.value\"\r\n                    :label=\"district.label\"\r\n                    :value=\"district.value\"\r\n                ></el-option>\r\n              </el-select>\r\n              <el-input\r\n                  v-model=\"form.detailAddress\"\r\n                  placeholder=\"请输入详细地址（街道、门牌号等）\"\r\n                  clearable\r\n                  style=\"width: calc(100% - 160px);\"\r\n                  @input=\"updateAddress\"\r\n              ></el-input>\r\n            </div>\r\n            <div class=\"full-address-preview\" v-if=\"form.fullAddress\">\r\n              <i class=\"el-icon-info\"></i> 完整地址: {{ form.fullAddress }}\r\n            </div>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"收件人\" prop=\"recipient\">\r\n            <el-input\r\n                v-model=\"form.recipient\"\r\n                placeholder=\"请输入收件人姓名\"\r\n                clearable\r\n            ></el-input>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"联系方式\" prop=\"tel\">\r\n            <el-input\r\n                v-model=\"form.tel\"\r\n                placeholder=\"请输入手机号码\"\r\n                clearable\r\n            ></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-card>\r\n\r\n      <!-- 商品信息 -->\r\n      <el-card class=\"goods-card\">\r\n        <div slot=\"header\" class=\"card-header\">\r\n          <i class=\"el-icon-shopping-cart-2\"></i>\r\n          <span>商品信息</span>\r\n        </div>\r\n        <el-table\r\n            :data=\"confirmDataList\"\r\n            border\r\n            class=\"goods-table\"\r\n            v-if=\"confirmDataList\"\r\n            header-row-class-name=\"table-header\"\r\n        >\r\n          <el-table-column label=\"商品信息\" width=\"400\">\r\n            <template slot-scope=\"{row}\">\r\n              <div class=\"goods-info\">\r\n                <el-image\r\n                    :src=\"row.book.url || require('@/assets/default-book.png')\"\r\n                    class=\"goods-image\"\r\n                ></el-image>\r\n                <div class=\"goods-desc\">\r\n                  <div class=\"name\">{{ row.book.name }}</div>\r\n                  <div class=\"author\">{{ row.book.author }}</div>\r\n                </div>\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"原价\" align=\"center\">\r\n            <template slot-scope=\"{row}\">\r\n              <span class=\"original-price\">\r\n                ¥{{ row.originalPrice.toFixed(2) }}\r\n              </span>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"折扣价\" align=\"center\">\r\n            <template slot-scope=\"{row}\">\r\n              <span class=\"discount-price\">\r\n                ¥{{ row.discountPrice.toFixed(2) }}\r\n              </span>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column\r\n              prop=\"orderItem.quantity\"\r\n              label=\"数量\"\r\n              align=\"center\"\r\n          />\r\n\r\n          <el-table-column label=\"小计\" align=\"center\">\r\n            <template slot-scope=\"{row}\">\r\n              ¥{{ (row.discountPrice * row.orderItem.quantity).toFixed(2) }}\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n\r\n        <!-- 添加加载状态提示 -->\r\n        <div v-else class=\"loading-container\">\r\n          <i class=\"el-icon-loading\"></i>\r\n          正在加载订单信息...\r\n        </div>\r\n      </el-card>\r\n\r\n      <!-- 金额汇总 -->\r\n        <div class=\"total-line grand-total\">\r\n          <span>总额：</span>\r\n          <span class=\"red-text\">¥{{ total.toFixed(2) }}</span>\r\n        </div>\r\n        <el-button\r\n            type=\"danger\"\r\n            class=\"submit-btn\"\r\n            @click=\"handleSubmit\"\r\n        >\r\n          提交订单\r\n        </el-button>\r\n      </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    // 手机号验证规则\r\n    const validatePhone = (rule, value, callback) => {\r\n      if (!/^1[3-9]\\d{9}$/.test(value)) {\r\n        callback(new Error('请输入正确的手机号码'));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n\r\n    return {\r\n      beijingDistricts: [\r\n        { value: '东城区', label: '东城区' },\r\n        { value: '西城区', label: '西城区' },\r\n        { value: '朝阳区', label: '朝阳区' },\r\n        { value: '丰台区', label: '丰台区' },\r\n        { value: '石景山区', label: '石景山区' },\r\n        { value: '海淀区', label: '海淀区' },\r\n        { value: '门头沟区', label: '门头沟区' },\r\n        { value: '房山区', label: '房山区' },\r\n        { value: '通州区', label: '通州区' },\r\n        { value: '顺义区', label: '顺义区' },\r\n        { value: '昌平区', label: '昌平区' },\r\n        { value: '大兴区', label: '大兴区' },\r\n        { value: '怀柔区', label: '怀柔区' },\r\n        { value: '平谷区', label: '平谷区' },\r\n        { value: '密云区', label: '密云区' },\r\n        { value: '延庆区', label: '延庆区' }\r\n      ],\r\n      confirmDataList: [],\r\n      form: {\r\n        address: '',\r\n        recipient: '',\r\n        tel: '',\r\n        district: '',\r\n        detailAddress: '',\r\n        fullAddress: '',\r\n      },\r\n      rules: {\r\n        address: [\r\n          { required: true, message: '请输入收货地址', trigger: 'blur' }\r\n        ],\r\n        recipient: [\r\n          { required: true, message: '请输入收件人姓名', trigger: 'blur' }\r\n        ],\r\n        tel: [\r\n          { required: true, message: '请输入联系方式', trigger: 'blur' },\r\n          { validator: validatePhone, trigger: 'blur' }\r\n        ]\r\n      },\r\n      total: 0\r\n    };\r\n  },\r\n  created() {\r\n    this.loadConfirmData();\r\n  },\r\n  methods: {\r\n    updateAddress() {\r\n      // 更新完整地址\r\n      this.form.fullAddress = `北京市${this.form.district}${this.form.detailAddress}`;\r\n\r\n      // 如果需要将完整地址提交到后端，可以在这里更新form.address\r\n      this.form.address = this.form.fullAddress;\r\n    },\r\n    async loadConfirmData() {\r\n      try {\r\n        const type = this.$route.query.type;\r\n        if (type === 'batch') {\r\n          const oiids = JSON.parse(this.$route.query.oiids);\r\n          const { data } = await this.$axios.post(this.$httpUrl + '/order/confirmBatch', {\r\n            oiids: oiids\r\n          });\r\n          if (data.code === 200) {\r\n            this.confirmDataList = data.data;\r\n            this.total = data.data.reduce((sum, item) =>\r\n                sum + (item.discountPrice * item.orderItem.quantity), 0);\r\n          }\r\n        } else {\r\n          const oiid = this.$route.query.oiid;\r\n          const {data} = await this.$axios.get(\r\n              `${this.$httpUrl}/order/confirm?oiid=${oiid}`\r\n          );\r\n          if (data.code === 200) {\r\n            console.log(data.data)\r\n            this.confirmDataList = [data.data];\r\n            this.total = data.data.discountPrice * data.data.orderItem.quantity;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('获取订单信息失败');\r\n      }\r\n    },\r\n\r\n    handleSubmit() {\r\n      this.$refs.formRef.validate(async valid => {\r\n        if (valid) {\r\n          try {\r\n            const { data } = await this.$axios.post(\r\n                `${this.$httpUrl}/order/create`,\r\n                {\r\n                  oiids: this.confirmDataList.map(item => item.orderItem.id),\r\n                  ...this.form\r\n                }\r\n            );\r\n            if (data.code === 200) {\r\n              this.$router.push({\r\n                path: '/pay',\r\n                query: {\r\n                  oid: data.data.oid,\r\n                  total: data.data.total\r\n                }\r\n              });\r\n            }\r\n          } catch (error) {\r\n            this.$message.error('提交订单失败');\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.confirm-container {\r\n  padding: 20px 200px;\r\n  background: #f5f5f5;\r\n}\r\n\r\n.steps {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.main-content {\r\n  background: white;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n}\r\n\r\n.card-header {\r\n  font-size: 18px;\r\n  color: #333;\r\n}\r\n\r\n.card-header i {\r\n  margin-right: 8px;\r\n  color: #409EFF;\r\n}\r\n\r\n.shipping-form {\r\n  padding: 0 50px;\r\n}\r\n\r\n.goods-info {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.goods-image {\r\n  width: 60px;\r\n  height: 80px;\r\n  margin-right: 15px;\r\n}\r\n\r\n.goods-desc .name {\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.goods-desc .author {\r\n  color: #666;\r\n  font-size: 12px;\r\n}\r\n\r\n.original-price {\r\n  text-decoration: line-through;\r\n  color: #999;\r\n}\r\n\r\n.discount-price {\r\n  color: #f56c6c;\r\n  font-weight: bold;\r\n}\r\n\r\n\r\n\r\n.total-line {\r\n  margin: 10px 0;\r\n  font-size: 14px;\r\n}\r\n\r\n.grand-total {\r\n  font-size: 18px;\r\n  margin-top: 20px;\r\n}\r\n\r\n.red-text {\r\n  color: #f56c6c;\r\n  font-weight: bold;\r\n  font-size: 24px;\r\n}\r\n\r\n.submit-btn {\r\n  margin-top: 20px;\r\n  width: 200px;\r\n  height: 50px;\r\n  font-size: 18px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}