{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { formatDate } from \"@/store/formatDate\";\nexport default {\n  name: \"UserCenter\",\n  data() {\n    let checkDuplicate = (rule, value, callback) => {\n      if (this.userInfo.id) {\n        return callback();\n      }\n      this.$axios.get(this.$httpUrl + \"/user/findByNo?no=\" + this.userInfo.no).then(res => res.data).then(res => {\n        if (res.code !== 200) {\n          callback();\n        } else {\n          callback(new Error('Áî®Êà∑ÂêçÂ∑≤ÁªèÂ≠òÂú®'));\n        }\n      });\n    };\n    return {\n      levels: ['ÈùíÈìú‰ºöÂëò', 'ÁôΩÈì∂‰ºöÂëò', 'ÈªÑÈáë‰ºöÂëò', 'ÈìÇÈáë‰ºöÂëò', 'ÈíªÁü≥‰ºöÂëò'],\n      levelThresholds: [0, 1000, 2000, 3000, 4000],\n      // ÂêÑÁ≠âÁ∫ßÊâÄÈúÄÊúÄ‰ΩéÁßØÂàÜ\n      recentOrders: [],\n      loadingOrders: false,\n      saving: false,\n      uploadDialogVisible: false,\n      avatarPreview: '',\n      uploading: false,\n      userInfo: {\n        id: '',\n        no: '',\n        name: '',\n        password: '',\n        email: '',\n        phone: '',\n        company: '',\n        avatar: ''\n      },\n      rules: {\n        no: [{\n          required: true,\n          message: 'ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÁî®Êà∑Âêç',\n          trigger: 'blur'\n        }, {\n          min: 3,\n          max: 8,\n          message: 'ÈïøÂ∫¶Âú® 3 Âà∞ 8 ‰∏™Â≠óÁ¨¶',\n          trigger: 'blur'\n        }, {\n          validator: checkDuplicate,\n          trigger: 'blur'\n        }],\n        name: [{\n          required: true,\n          message: 'ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÊòµÁß∞',\n          trigger: 'blur'\n        }],\n        password: [{\n          required: true,\n          message: 'ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÂØÜÁ†Å',\n          trigger: 'blur'\n        }, {\n          min: 3,\n          max: 8,\n          message: 'ÈïøÂ∫¶Âú® 3 Âà∞ 8 ‰∏™Â≠óÁ¨¶',\n          trigger: 'blur'\n        }],\n        email: [{\n          required: true,\n          message: 'ËØ∑ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÁîµÂ≠êÈÇÆ‰ª∂',\n          trigger: 'blur'\n        }],\n        phone: [{\n          required: true,\n          message: \"ÊâãÊú∫Âè∑‰∏çËÉΩ‰∏∫Á©∫ÔºåËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÊâãÊú∫Âè∑\",\n          trigger: \"blur\"\n        }, {\n          pattern: /^1[3|4|5|6|7|8|9][0-9]\\d{8}$/,\n          message: \"ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÊâãÊú∫Âè∑Á†Å\",\n          trigger: \"blur\"\n        }],\n        company: [{\n          required: true,\n          message: 'ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÂú∞ÂùÄ',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created() {\n    this.loadUserProfile();\n    this.loadRecentOrders();\n  },\n  computed: {\n    // ËÆ°ÁÆóÂΩìÂâç‰ºöÂëòÁ≠âÁ∫ß\n    currentLevel() {\n      if (!this.userInfo.score) return this.levels[0];\n      const levelIndex = Math.floor(this.userInfo.score / 1000);\n      return this.levels[Math.min(levelIndex, this.levels.length - 1)];\n    }\n  },\n  methods: {\n    // ‰øÆÊîπÊ†áÁ≠æÁ±ªÂûãÊò†Â∞Ñ\n    levelTagType(level) {\n      const map = {\n        'ÈùíÈìú‰ºöÂëò': 'info',\n        'ÁôΩÈì∂‰ºöÂëò': 'primary',\n        'ÈªÑÈáë‰ºöÂëò': 'success',\n        'ÈìÇÈáë‰ºöÂëò': 'warning',\n        'ÈíªÁü≥‰ºöÂëò': 'danger'\n      };\n      return map[level] || 'info';\n    },\n    statusTagType(status) {\n      const map = {\n        'ÂæÖ‰ªòÊ¨æ': 'warning',\n        'Â∑≤‰ªòÊ¨æ': 'primary',\n        'Â∑≤ÂèëË¥ß': 'success',\n        'Â∑≤ÂÆåÊàê': 'success',\n        'Â∑≤ÂèñÊ∂à': 'danger'\n      };\n      return map[status] || 'info';\n    },\n    async loadRecentOrders() {\n      try {\n        this.loadingOrders = true;\n        const userId = JSON.parse(sessionStorage.getItem('CurUser')).id;\n        const res = await this.$axios.get(this.$httpUrl + '/user/recent', {\n          params: {\n            userId\n          }\n        });\n        if (res.data.code === 200) {\n          this.recentOrders = res.data.data.map(order => ({\n            id: order.id,\n            title: this.formatBookNames(order.items),\n            date: this.formatTime(order.createtime),\n            status: order.status\n          }));\n        }\n      } catch (error) {\n        this.$message.error('Ëé∑ÂèñËÆ¢ÂçïÂ§±Ë¥•');\n      } finally {\n        this.loadingOrders = false;\n      }\n    },\n    formatBookNames(items) {\n      if (items.length === 1) {\n        return `„Ää${items[0].book.name}„Äã`;\n      }\n      return `„Ää${items[0].book.name}„ÄãÁ≠â${items.length}‰ª∂ÂïÜÂìÅ`;\n    },\n    formatTime(timeStr) {\n      const date = new Date(timeStr);\n      return formatDate(date, 'yyyy-MM-dd');\n    },\n    async loadUserProfile() {\n      try {\n        this.loading = true;\n        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Ëé∑ÂèñÁî®Êà∑ID\n        const userId = JSON.parse(sessionStorage.getItem('CurUser')).id;\n        const res = await this.$axios.get(this.$httpUrl + '/user/profile', {\n          params: {\n            id: userId\n          }\n        });\n        if (res.data.code === 200) {\n          this.userInfo = res.data.data;\n          this.userInfo.score = this.userInfo.score || 1500;\n        }\n      } catch (error) {\n        this.$message.error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');\n      }\n    },\n    async saveInfo() {\n      try {\n        await this.$refs.userInfoForm.validate();\n        // ÊûÑÈÄ†Êõ¥Êñ∞Êï∞ÊçÆ\n        const updateData = {\n          ...this.userInfo,\n          // Â¶ÇÊûúÂØÜÁ†Å‰∏∫Á©∫Âàô‰øùÁïôÂéüÂØÜÁ†Å\n          password: this.userInfo.password || undefined\n        };\n        const res = await this.$axios.post(this.$httpUrl + '/user/uupdate', updateData);\n        if (res.data.code === 200) {\n          this.$message.success('‰ø°ÊÅØÊõ¥Êñ∞ÊàêÂäü');\n          // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®\n          const storedUser = JSON.parse(sessionStorage.getItem('CurUser'));\n          sessionStorage.setItem('CurUser', JSON.stringify({\n            ...storedUser,\n            ...updateData,\n            password: '' // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®Âú®ÊµèËßàÂô®ÁöÑÂØÜÁ†Å\n          }));\n        }\n      } catch (error) {\n        this.$message.error(error.response?.data?.msg || 'Êõ¥Êñ∞Â§±Ë¥•');\n      }\n    },\n    showUploadDialog() {\n      this.uploadDialogVisible = true;\n    },\n    handleFileChange(file) {\n      const isImage = file.raw.type.startsWith('image/');\n      const isLt2M = file.size / 1024 / 1024 < 2;\n      if (!isImage) {\n        this.$message.error('Âè™ËÉΩ‰∏ä‰º†ÂõæÁâáÊ†ºÂºè!');\n        return false;\n      }\n      if (!isLt2M) {\n        this.$message.error('ÂõæÁâáÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá2MB!');\n        return false;\n      }\n      this.avatarPreview = URL.createObjectURL(file.raw);\n      this.uploadFile = file.raw;\n    },\n    async uploadAvatar() {\n      if (!this.uploadFile) {\n        this.$message.warning('ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑÂ§¥ÂÉè');\n        return;\n      }\n      try {\n        this.uploading = true;\n        const formData = new FormData();\n        formData.append('file', this.uploadFile);\n        formData.append('userId', this.userInfo.id);\n        const res = await this.$axios.post(this.$httpUrl + '/file/uploadAvatar', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        });\n        if (res.data.code === 200) {\n          this.userInfo.avatar = res.data.data;\n          this.$message.success('Â§¥ÂÉèÊõ¥Êñ∞ÊàêÂäü');\n          this.uploadDialogVisible = false;\n          // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®\n          const storedUser = JSON.parse(sessionStorage.getItem('CurUser'));\n          storedUser.avatar = res.data.data;\n          sessionStorage.setItem('CurUser', JSON.stringify(storedUser));\n        }\n      } catch (error) {\n        this.$message.error('‰∏ä‰º†Â§±Ë¥•');\n      } finally {\n        this.uploading = false;\n      }\n    },\n    goMyReview() {\n      this.$router.push('/myreview');\n    },\n    goMyReservation() {\n      this.$router.push('/myreservation');\n    }\n  }\n};","map":{"version":3,"names":["formatDate","name","data","checkDuplicate","rule","value","callback","userInfo","id","$axios","get","$httpUrl","no","then","res","code","Error","levels","levelThresholds","recentOrders","loadingOrders","saving","uploadDialogVisible","avatarPreview","uploading","password","email","phone","company","avatar","rules","required","message","trigger","min","max","validator","pattern","created","loadUserProfile","loadRecentOrders","computed","currentLevel","score","levelIndex","Math","floor","length","methods","levelTagType","level","map","statusTagType","status","userId","JSON","parse","sessionStorage","getItem","params","order","title","formatBookNames","items","date","formatTime","createtime","error","$message","book","timeStr","Date","loading","saveInfo","$refs","userInfoForm","validate","updateData","undefined","post","success","storedUser","setItem","stringify","response","msg","showUploadDialog","handleFileChange","file","isImage","raw","type","startsWith","isLt2M","size","URL","createObjectURL","uploadFile","uploadAvatar","warning","formData","FormData","append","headers","goMyReview","$router","push","goMyReservation"],"sources":["src/user/UserCenter.vue"],"sourcesContent":["<template>\r\n  <div class=\"user-center-container\">\r\n    <!-- Â§¥ÈÉ®Âå∫Âüü -->\r\n    <div class=\"header-banner\">\r\n      <img src=\"@/assets/logo.png\" class=\"store-logo\" alt=\"‰π¶Â∫ólogo\">\r\n      <h1 class=\"welcome-text\">Ê¨¢ËøéÂõûÊù•Ôºå{{ userInfo.name || '‰π¶Âèã' }}ÔºÅ</h1>\r\n    </div>\r\n\r\n    <div class=\"main-content\">\r\n      <!-- Â∑¶‰æß‰∏™‰∫∫‰ø°ÊÅØ -->\r\n      <div class=\"profile-section\">\r\n        <el-card class=\"profile-card\">\r\n          <div slot=\"header\" class=\"clearfix\">\r\n            <span class=\"card-title\">üìñ ÊàëÁöÑË¥¶Êà∑</span>\r\n          </div>\r\n\r\n          <!-- Áî®Êà∑Â§¥ÂÉè -->\r\n          <div class=\"avatar-section\">\r\n            <el-avatar :size=\"100\" :src=\"userInfo.avatar || require('@/assets/default-avatar.png')\"></el-avatar>\r\n            <el-button type=\"text\" class=\"upload-btn\" @click=\"showUploadDialog\">Êõ¥Êç¢Â§¥ÂÉè</el-button>\r\n          </div>\r\n\r\n          <!-- ‰ºöÂëò‰ø°ÊÅØ -->\r\n          <div class=\"membership-info\">\r\n            <div class=\"info-item\">\r\n              <span class=\"label\">‰ºöÂëòÁ≠âÁ∫ßÔºö</span>\r\n              <el-tag :type=\"levelTagType(currentLevel)\">{{ currentLevel }}</el-tag>\r\n            </div>\r\n            <div class=\"info-item\">\r\n              <span class=\"label\">ÁßØÂàÜÔºö</span>\r\n              <span class=\"value\">{{ userInfo.score }} ÂàÜ</span>\r\n            </div>\r\n          </div>\r\n        </el-card>\r\n\r\n        <!--ÊúÄËøëËÆ¢Âçï-->\r\n        <el-card class=\"order-card\">\r\n          <div slot=\"header\" class=\"clearfix\">\r\n            <span class=\"card-title\">üì¶ ÊúÄËøëËÆ¢Âçï</span>\r\n            <el-button\r\n                type=\"text\"\r\n                @click=\"$router.push('/order')\"\r\n                :loading=\"loadingOrders\"\r\n            >\r\n              {{ loadingOrders ? 'Âä†ËΩΩ‰∏≠...' : 'Êü•ÁúãÂÖ®ÈÉ®' }}\r\n            </el-button>\r\n          </div>\r\n          <div class=\"order-list\">\r\n            <div v-for=\"order in recentOrders\" :key=\"order.id\" class=\"order-item\">\r\n              <div class=\"order-info\">\r\n                <span class=\"order-title\">{{ order.title }}</span>\r\n                <span class=\"order-date\">{{ order.date }}</span>\r\n              </div>\r\n              <el-tag :type=\"statusTagType(order.status)\">\r\n                {{ order.status }}\r\n              </el-tag>\r\n            </div>\r\n            <div v-if=\"!loadingOrders && recentOrders.length === 0\" class=\"empty-orders\">\r\n              ÊöÇÊó†ÊúÄËøëËÆ¢Âçï\r\n            </div>\r\n          </div>\r\n        </el-card>\r\n      </div>\r\n\r\n      <!-- Âè≥‰æßË°®Âçï -->\r\n      <div class=\"form-section\">\r\n        <el-card class=\"form-card\">\r\n          <div slot=\"header\" class=\"clearfix\">\r\n            <span class=\"card-title\">‚úèÔ∏è ÁºñËæëËµÑÊñô</span>\r\n          </div>\r\n          <el-form\r\n              :model=\"userInfo\"\r\n              ref=\"userInfoForm\"\r\n              :rules=\"rules\"\r\n              label-width=\"100px\"\r\n              class=\"user-form\"\r\n          >\r\n            <el-form-item label=\"Áî®Êà∑Âêç\" prop=\"no\">\r\n              <el-input v-model=\"userInfo.no\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"ÊòµÁß∞\" prop=\"name\">\r\n              <el-input v-model=\"userInfo.name\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"ÂØÜÁ†Å\" prop=\"password\">\r\n              <el-input v-model=\"userInfo.password\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"ÁîµÂ≠êÈÇÆ‰ª∂\" prop=\"email\">\r\n              <el-input v-model=\"userInfo.email\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"ËÅîÁ≥ªÊñπÂºè\" prop=\"phone\">\r\n              <el-input v-model=\"userInfo.phone\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"ÊàëÁöÑÂú∞ÂùÄ\" prop=\"company\">\r\n              <el-input v-model=\"userInfo.company\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"saveInfo\">‰øùÂ≠ò‰ø°ÊÅØ</el-button>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button\r\n                  type=\"primary\"\r\n                  @click=\"saveInfo\"\r\n                  class=\"save-btn\"\r\n                  :loading=\"saving\"\r\n              >\r\n                <i class=\"el-icon-check\"></i> ‰øùÂ≠ò‰øÆÊîπ\r\n              </el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-card>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"service-cards\">\r\n      <el-card class=\"service-card\">\r\n        <div class=\"service-content\">\r\n          <i class=\"el-icon-tickets service-icon\"></i>\r\n          <h3>ÊàëÁöÑËØÑËÆ∫</h3>\r\n          <p>Êü•ÁúãÊÇ®ÂèëÂá∫ÁöÑËØÑËÆ∫ÊòØÂê¶ÈÄöËøá</p>\r\n          <el-button type=\"text\" @click=\"goMyReview\">Á´ãÂç≥Êü•Áúã ></el-button>\r\n        </div>\r\n      </el-card>\r\n\r\n      <el-card class=\"service-card\">\r\n        <div class=\"service-content\">\r\n          <i class=\"el-icon-star-off service-icon\"></i>\r\n          <h3>ÊàëÁöÑÊ±ÇË¥≠/È¢ÑÂÆö</h3>\r\n          <p>Êü•ÁúãÊÇ®ÁöÑÊ±ÇË¥≠ÊàñÈ¢ÑÂÆöÊòØÂê¶Âà∞Ë¥ß</p>\r\n          <el-button type=\"text\" @click=\"goMyReservation\">Á´ãÂç≥Êü•Áúã ></el-button>\r\n        </div>\r\n      </el-card>\r\n    </div>\r\n\r\n    <!-- Â§¥ÂÉè‰∏ä‰º†ÂØπËØùÊ°Ü -->\r\n    <el-dialog\r\n        title=\"Êõ¥Êç¢Â§¥ÂÉè\"\r\n        :visible.sync=\"uploadDialogVisible\"\r\n        width=\"30%\"\r\n        :close-on-click-modal=\"false\"\r\n    >\r\n      <div class=\"upload-content\">\r\n        <el-upload\r\n            class=\"avatar-uploader\"\r\n            action=\"\"\r\n            :show-file-list=\"false\"\r\n            :auto-upload=\"false\"\r\n            :on-change=\"handleFileChange\"\r\n            accept=\"image/jpeg,image/png\"\r\n        >\r\n          <div class=\"avatar-preview\">\r\n            <img v-if=\"avatarPreview\" :src=\"avatarPreview\" class=\"avatar\">\r\n            <div v-else class=\"upload-trigger\">\r\n              <i class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n              <div class=\"upload-tips\">ÁÇπÂáª‰∏ä‰º†Â§¥ÂÉè</div>\r\n            </div>\r\n            <div class=\"hover-mask\">\r\n              <i class=\"el-icon-zoom-in\"></i>\r\n            </div>\r\n          </div>\r\n        </el-upload>\r\n        <div class=\"action-buttons\">\r\n          <el-button\r\n              type=\"primary\"\r\n              :loading=\"uploading\"\r\n              @click=\"uploadAvatar\"\r\n          >Á°ÆËÆ§‰∏ä‰º†</el-button>\r\n        </div>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {formatDate} from \"@/store/formatDate\";\r\n\r\nexport default {\r\n  name: \"UserCenter\",\r\n  data() {\r\n    let checkDuplicate =(rule,value,callback)=>{\r\n      if(this.userInfo.id){\r\n        return callback();\r\n      }\r\n      this.$axios.get(this.$httpUrl+\"/user/findByNo?no=\"+this.userInfo.no).then(res=>res.data).then(res=>{\r\n        if(res.code!==200){\r\n          callback()\r\n        }else{\r\n          callback(new Error('Áî®Êà∑ÂêçÂ∑≤ÁªèÂ≠òÂú®'));\r\n        }\r\n      })\r\n    };\r\n    return {\r\n      levels: ['ÈùíÈìú‰ºöÂëò', 'ÁôΩÈì∂‰ºöÂëò', 'ÈªÑÈáë‰ºöÂëò', 'ÈìÇÈáë‰ºöÂëò', 'ÈíªÁü≥‰ºöÂëò'],\r\n      levelThresholds: [0, 1000, 2000, 3000, 4000], // ÂêÑÁ≠âÁ∫ßÊâÄÈúÄÊúÄ‰ΩéÁßØÂàÜ\r\n      recentOrders: [],\r\n      loadingOrders: false,\r\n      saving: false,\r\n      uploadDialogVisible: false,\r\n      avatarPreview: '',\r\n      uploading: false,\r\n      userInfo: {\r\n        id:'',\r\n        no:'',\r\n        name:'',\r\n        password:'',\r\n        email:'',\r\n        phone:'',\r\n        company:'',\r\n        avatar:''\r\n      },\r\n\r\n      rules: {\r\n        no: [\r\n          {required: true, message: 'ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÁî®Êà∑Âêç', trigger: 'blur'},\r\n          {min: 3, max: 8, message: 'ÈïøÂ∫¶Âú® 3 Âà∞ 8 ‰∏™Â≠óÁ¨¶', trigger: 'blur'},\r\n          {validator:checkDuplicate,trigger: 'blur'}\r\n        ],\r\n        name: [\r\n          {required: true, message: 'ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÊòµÁß∞', trigger: 'blur'}\r\n        ],\r\n        password: [\r\n          {required: true, message: 'ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÂØÜÁ†Å', trigger: 'blur'},\r\n          {min: 3, max: 8, message: 'ÈïøÂ∫¶Âú® 3 Âà∞ 8 ‰∏™Â≠óÁ¨¶', trigger: 'blur'}\r\n        ],\r\n        email: [\r\n          {required: true, message: 'ËØ∑ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÁîµÂ≠êÈÇÆ‰ª∂', trigger: 'blur'}\r\n        ],\r\n        phone: [\r\n          {required: true,message: \"ÊâãÊú∫Âè∑‰∏çËÉΩ‰∏∫Á©∫ÔºåËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÊâãÊú∫Âè∑\",trigger: \"blur\"},\r\n          {pattern: /^1[3|4|5|6|7|8|9][0-9]\\d{8}$/, message: \"ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÊâãÊú∫Âè∑Á†Å\", trigger: \"blur\"}\r\n        ],\r\n        company: [\r\n          {required: true, message: 'ËØ∑Êõ¥Êñ∞ÊÇ®ÁöÑÂú∞ÂùÄ', trigger: 'blur'}\r\n        ],\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.loadUserProfile();\r\n    this.loadRecentOrders();\r\n  },\r\n  computed: {\r\n    // ËÆ°ÁÆóÂΩìÂâç‰ºöÂëòÁ≠âÁ∫ß\r\n    currentLevel() {\r\n      if (!this.userInfo.score) return this.levels[0];\r\n      const levelIndex = Math.floor(this.userInfo.score / 1000);\r\n      return this.levels[Math.min(levelIndex, this.levels.length - 1)];\r\n    }\r\n  },\r\n  methods: {\r\n    // ‰øÆÊîπÊ†áÁ≠æÁ±ªÂûãÊò†Â∞Ñ\r\n    levelTagType(level) {\r\n      const map = {\r\n        'ÈùíÈìú‰ºöÂëò': 'info',\r\n        'ÁôΩÈì∂‰ºöÂëò': 'primary',\r\n        'ÈªÑÈáë‰ºöÂëò': 'success',\r\n        'ÈìÇÈáë‰ºöÂëò': 'warning',\r\n        'ÈíªÁü≥‰ºöÂëò': 'danger'\r\n      };\r\n      return map[level] || 'info';\r\n    },\r\n    statusTagType(status) {\r\n      const map = {\r\n        'ÂæÖ‰ªòÊ¨æ': 'warning',\r\n        'Â∑≤‰ªòÊ¨æ': 'primary',\r\n        'Â∑≤ÂèëË¥ß': 'success',\r\n        'Â∑≤ÂÆåÊàê': 'success',\r\n        'Â∑≤ÂèñÊ∂à': 'danger'\r\n      }\r\n      return map[status] || 'info';\r\n    },\r\n    async loadRecentOrders() {\r\n      try {\r\n        this.loadingOrders = true;\r\n        const userId = JSON.parse(sessionStorage.getItem('CurUser')).id;\r\n        const res = await this.$axios.get(this.$httpUrl+'/user/recent', {\r\n          params: { userId }\r\n        });\r\n        if (res.data.code === 200) {\r\n          this.recentOrders = res.data.data.map(order => ({\r\n            id: order.id,\r\n            title: this.formatBookNames(order.items),\r\n            date: this.formatTime(order.createtime),\r\n            status: order.status\r\n          }));\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('Ëé∑ÂèñËÆ¢ÂçïÂ§±Ë¥•');\r\n      } finally {\r\n        this.loadingOrders = false;\r\n      }\r\n    },\r\n\r\n    formatBookNames(items) {\r\n      if (items.length === 1) {\r\n        return `„Ää${items[0].book.name}„Äã`;\r\n      }\r\n      return `„Ää${items[0].book.name}„ÄãÁ≠â${items.length}‰ª∂ÂïÜÂìÅ`;\r\n    },\r\n    formatTime(timeStr) {\r\n      const date = new Date(timeStr);\r\n      return formatDate(date, 'yyyy-MM-dd');\r\n    },\r\n    async loadUserProfile() {\r\n      try {\r\n        this.loading = true;\r\n        // ‰ªéÊú¨Âú∞Â≠òÂÇ®Ëé∑ÂèñÁî®Êà∑ID\r\n        const userId = JSON.parse(sessionStorage.getItem('CurUser')).id;\r\n        const res = await this.$axios.get(this.$httpUrl+'/user/profile', {\r\n          params: {\r\n            id: userId\r\n          }\r\n        });\r\n        if (res.data.code === 200) {\r\n          this.userInfo = res.data.data;\r\n          this.userInfo.score = this.userInfo.score || 1500;\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•');\r\n      }\r\n    },\r\n    async saveInfo() {\r\n      try {\r\n        await this.$refs.userInfoForm.validate();\r\n        // ÊûÑÈÄ†Êõ¥Êñ∞Êï∞ÊçÆ\r\n        const updateData = {\r\n          ...this.userInfo,\r\n          // Â¶ÇÊûúÂØÜÁ†Å‰∏∫Á©∫Âàô‰øùÁïôÂéüÂØÜÁ†Å\r\n          password: this.userInfo.password || undefined\r\n        };\r\n        const res = await this.$axios.post(this.$httpUrl+'/user/uupdate', updateData);\r\n        if (res.data.code === 200) {\r\n          this.$message.success('‰ø°ÊÅØÊõ¥Êñ∞ÊàêÂäü');\r\n          // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®\r\n          const storedUser = JSON.parse(sessionStorage.getItem('CurUser'));\r\n          sessionStorage.setItem('CurUser', JSON.stringify({\r\n            ...storedUser,\r\n            ...updateData,\r\n            password: '' // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®Âú®ÊµèËßàÂô®ÁöÑÂØÜÁ†Å\r\n          }));\r\n        }\r\n      } catch (error) {\r\n        this.$message.error(error.response?.data?.msg || 'Êõ¥Êñ∞Â§±Ë¥•');\r\n      }\r\n    },\r\n    showUploadDialog() {\r\n      this.uploadDialogVisible = true\r\n    },\r\n    handleFileChange(file) {\r\n      const isImage = file.raw.type.startsWith('image/');\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isImage) {\r\n        this.$message.error('Âè™ËÉΩ‰∏ä‰º†ÂõæÁâáÊ†ºÂºè!');\r\n        return false;\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('ÂõæÁâáÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá2MB!');\r\n        return false;\r\n      }\r\n\r\n      this.avatarPreview = URL.createObjectURL(file.raw);\r\n      this.uploadFile = file.raw;\r\n    },\r\n\r\n    async uploadAvatar() {\r\n      if (!this.uploadFile) {\r\n        this.$message.warning('ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑÂ§¥ÂÉè');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        this.uploading = true;\r\n        const formData = new FormData();\r\n        formData.append('file', this.uploadFile);\r\n        formData.append('userId', this.userInfo.id);\r\n\r\n        const res = await this.$axios.post(\r\n            this.$httpUrl + '/file/uploadAvatar',\r\n            formData,\r\n            {\r\n              headers: {\r\n                'Content-Type': 'multipart/form-data'\r\n              }\r\n            }\r\n        );\r\n        if (res.data.code === 200) {\r\n          this.userInfo.avatar = res.data.data;\r\n          this.$message.success('Â§¥ÂÉèÊõ¥Êñ∞ÊàêÂäü');\r\n          this.uploadDialogVisible = false;\r\n          // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®\r\n          const storedUser = JSON.parse(sessionStorage.getItem('CurUser'));\r\n          storedUser.avatar = res.data.data;\r\n          sessionStorage.setItem('CurUser', JSON.stringify(storedUser));\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('‰∏ä‰º†Â§±Ë¥•');\r\n      } finally {\r\n        this.uploading = false;\r\n      }\r\n    },\r\n    goMyReview(){\r\n      this.$router.push('/myreview');\r\n    },\r\n    goMyReservation(){\r\n      this.$router.push('/myreservation');\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.user-center-container {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n}\r\n\r\n.header-banner {\r\n  background: linear-gradient(135deg, #2c3e50, #3498db);\r\n  padding: 40px;\r\n  border-radius: 8px;\r\n  margin-bottom: 30px;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.store-logo {\r\n  width: 120px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.welcome-text {\r\n  color: white;\r\n  font-size: 28px;\r\n  margin: 0;\r\n  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\r\n}\r\n\r\n.main-content {\r\n  display: grid;\r\n  grid-template-columns: 1fr 2fr;\r\n  gap: 24px;\r\n  margin-bottom: 24px;\r\n}\r\n\r\n.profile-card, .form-card {\r\n  border-radius: 12px;\r\n  box-shadow: 0 4px 12px rgba(0,0,0,0.1);\r\n  margin-bottom: 24px;\r\n}\r\n\r\n.card-title {\r\n  font-size: 20px;\r\n  font-weight: 600;\r\n  color: #2c3e50;\r\n}\r\n\r\n.avatar-section {\r\n  text-align: center;\r\n  padding: 20px 0;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.upload-btn {\r\n  margin-top: 10px;\r\n}\r\n\r\n.membership-info {\r\n  padding: 20px 0;\r\n}\r\n\r\n.info-item {\r\n  margin: 15px 0;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.label {\r\n  color: #666;\r\n  min-width: 80px;\r\n}\r\n\r\n.value {\r\n  color: #2c3e50;\r\n  font-weight: 500;\r\n}\r\n\r\n.order-card {\r\n  border-radius: 12px;\r\n  box-shadow: 0 4px 12px rgba(0,0,0,0.1);\r\n}\r\n\r\n.order-list {\r\n  max-height: 300px;\r\n  overflow-y: auto;\r\n}\r\n\r\n.order-item {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 12px 0;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.order-title {\r\n  font-weight: 500;\r\n  color: #333;\r\n}\r\n\r\n.order-date {\r\n  font-size: 12px;\r\n  color: #999;\r\n  display: block;\r\n}\r\n\r\n.service-cards {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\r\n  gap: 24px;\r\n}\r\n\r\n.service-card {\r\n  transition: transform 0.3s ease;\r\n  border-radius: 12px;\r\n}\r\n\r\n.service-card:hover {\r\n  transform: translateY(-5px);\r\n  box-shadow: 0 6px 16px rgba(0,0,0,0.1);\r\n}\r\n\r\n.service-content {\r\n  text-align: center;\r\n  padding: 30px;\r\n}\r\n\r\n.service-icon {\r\n  font-size: 40px;\r\n  color: #3498db;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.service-content h3 {\r\n  color: #2c3e50;\r\n  margin: 10px 0;\r\n}\r\n\r\n.service-content p {\r\n  color: #666;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.save-btn {\r\n  width: 100%;\r\n  padding: 12px 0;\r\n  font-size: 16px;\r\n}\r\n.upload-content {\r\n  text-align: center;\r\n}\r\n\r\n.avatar-uploader {\r\n  border: 2px dashed #d9d9d9;\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n  width: 200px;\r\n  height: 200px;\r\n  margin: 0 auto 20px;\r\n  transition: border-color 0.3s;\r\n}\r\n\r\n.avatar-uploader:hover {\r\n  border-color: #409EFF;\r\n}\r\n\r\n.avatar-preview {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n}\r\n\r\n.avatar {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n}\r\n\r\n.hover-mask {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0,0,0,0.5);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  opacity: 0;\r\n  transition: opacity 0.3s;\r\n}\r\n\r\n.hover-mask i {\r\n  color: white;\r\n  font-size: 24px;\r\n}\r\n\r\n.avatar-preview:hover .hover-mask {\r\n  opacity: 1;\r\n}\r\n\r\n.upload-trigger {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n  height: 100%;\r\n  color: #8c939d;\r\n}\r\n\r\n.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.upload-tips {\r\n  font-size: 12px;\r\n}\r\n\r\n.action-buttons {\r\n  margin-top: 20px;\r\n}\r\n.el-tag.info {\r\n  background-color: #e0f2f1;\r\n  color: #009688;\r\n}\r\n.el-tag.primary {\r\n  background-color: #e3f2fd;\r\n  color: #2196f3;\r\n}\r\n.el-tag.success {\r\n  background-color: #e8f5e9;\r\n  color: #4caf50;\r\n}\r\n.el-tag.warning {\r\n  background-color: #fff3cd;\r\n  color: #ff9800;\r\n}\r\n.el-tag.danger {\r\n  background-color: #ffebee;\r\n  color: #f44336;\r\n}\r\n</style>"],"mappings":";;;;;;AA6KA,SAAAA,UAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA,IAAAC,cAAA,GAAAA,CAAAC,IAAA,EAAAC,KAAA,EAAAC,QAAA;MACA,SAAAC,QAAA,CAAAC,EAAA;QACA,OAAAF,QAAA;MACA;MACA,KAAAG,MAAA,CAAAC,GAAA,MAAAC,QAAA,+BAAAJ,QAAA,CAAAK,EAAA,EAAAC,IAAA,CAAAC,GAAA,IAAAA,GAAA,CAAAZ,IAAA,EAAAW,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA;UACAT,QAAA;QACA;UACAA,QAAA,KAAAU,KAAA;QACA;MACA;IACA;IACA;MACAC,MAAA;MACAC,eAAA;MAAA;MACAC,YAAA;MACAC,aAAA;MACAC,MAAA;MACAC,mBAAA;MACAC,aAAA;MACAC,SAAA;MACAjB,QAAA;QACAC,EAAA;QACAI,EAAA;QACAX,IAAA;QACAwB,QAAA;QACAC,KAAA;QACAC,KAAA;QACAC,OAAA;QACAC,MAAA;MACA;MAEAC,KAAA;QACAlB,EAAA,GACA;UAAAmB,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAC,GAAA;UAAAC,GAAA;UAAAH,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAG,SAAA,EAAAjC,cAAA;UAAA8B,OAAA;QAAA,EACA;QACAhC,IAAA,GACA;UAAA8B,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,EACA;QACAR,QAAA,GACA;UAAAM,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAC,GAAA;UAAAC,GAAA;UAAAH,OAAA;UAAAC,OAAA;QAAA,EACA;QACAP,KAAA,GACA;UAAAK,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,EACA;QACAN,KAAA,GACA;UAAAI,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA,GACA;UAAAI,OAAA;UAAAL,OAAA;UAAAC,OAAA;QAAA,EACA;QACAL,OAAA,GACA;UAAAG,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;MAEA;IACA;EACA;EACAK,QAAA;IACA,KAAAC,eAAA;IACA,KAAAC,gBAAA;EACA;EACAC,QAAA;IACA;IACAC,aAAA;MACA,UAAAnC,QAAA,CAAAoC,KAAA,cAAA1B,MAAA;MACA,MAAA2B,UAAA,GAAAC,IAAA,CAAAC,KAAA,MAAAvC,QAAA,CAAAoC,KAAA;MACA,YAAA1B,MAAA,CAAA4B,IAAA,CAAAX,GAAA,CAAAU,UAAA,OAAA3B,MAAA,CAAA8B,MAAA;IACA;EACA;EACAC,OAAA;IACA;IACAC,aAAAC,KAAA;MACA,MAAAC,GAAA;QACA;QACA;QACA;QACA;QACA;MACA;MACA,OAAAA,GAAA,CAAAD,KAAA;IACA;IACAE,cAAAC,MAAA;MACA,MAAAF,GAAA;QACA;QACA;QACA;QACA;QACA;MACA;MACA,OAAAA,GAAA,CAAAE,MAAA;IACA;IACA,MAAAb,iBAAA;MACA;QACA,KAAApB,aAAA;QACA,MAAAkC,MAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAC,cAAA,CAAAC,OAAA,aAAAlD,EAAA;QACA,MAAAM,GAAA,cAAAL,MAAA,CAAAC,GAAA,MAAAC,QAAA;UACAgD,MAAA;YAAAL;UAAA;QACA;QACA,IAAAxC,GAAA,CAAAZ,IAAA,CAAAa,IAAA;UACA,KAAAI,YAAA,GAAAL,GAAA,CAAAZ,IAAA,CAAAA,IAAA,CAAAiD,GAAA,CAAAS,KAAA;YACApD,EAAA,EAAAoD,KAAA,CAAApD,EAAA;YACAqD,KAAA,OAAAC,eAAA,CAAAF,KAAA,CAAAG,KAAA;YACAC,IAAA,OAAAC,UAAA,CAAAL,KAAA,CAAAM,UAAA;YACAb,MAAA,EAAAO,KAAA,CAAAP;UACA;QACA;MACA,SAAAc,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;QACA,KAAA/C,aAAA;MACA;IACA;IAEA0C,gBAAAC,KAAA;MACA,IAAAA,KAAA,CAAAhB,MAAA;QACA,WAAAgB,KAAA,IAAAM,IAAA,CAAApE,IAAA;MACA;MACA,WAAA8D,KAAA,IAAAM,IAAA,CAAApE,IAAA,KAAA8D,KAAA,CAAAhB,MAAA;IACA;IACAkB,WAAAK,OAAA;MACA,MAAAN,IAAA,OAAAO,IAAA,CAAAD,OAAA;MACA,OAAAtE,UAAA,CAAAgE,IAAA;IACA;IACA,MAAAzB,gBAAA;MACA;QACA,KAAAiC,OAAA;QACA;QACA,MAAAlB,MAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAC,cAAA,CAAAC,OAAA,aAAAlD,EAAA;QACA,MAAAM,GAAA,cAAAL,MAAA,CAAAC,GAAA,MAAAC,QAAA;UACAgD,MAAA;YACAnD,EAAA,EAAA8C;UACA;QACA;QACA,IAAAxC,GAAA,CAAAZ,IAAA,CAAAa,IAAA;UACA,KAAAR,QAAA,GAAAO,GAAA,CAAAZ,IAAA,CAAAA,IAAA;UACA,KAAAK,QAAA,CAAAoC,KAAA,QAAApC,QAAA,CAAAoC,KAAA;QACA;MACA,SAAAwB,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;IACA;IACA,MAAAM,SAAA;MACA;QACA,WAAAC,KAAA,CAAAC,YAAA,CAAAC,QAAA;QACA;QACA,MAAAC,UAAA;UACA,QAAAtE,QAAA;UACA;UACAkB,QAAA,OAAAlB,QAAA,CAAAkB,QAAA,IAAAqD;QACA;QACA,MAAAhE,GAAA,cAAAL,MAAA,CAAAsE,IAAA,MAAApE,QAAA,oBAAAkE,UAAA;QACA,IAAA/D,GAAA,CAAAZ,IAAA,CAAAa,IAAA;UACA,KAAAqD,QAAA,CAAAY,OAAA;UACA;UACA,MAAAC,UAAA,GAAA1B,IAAA,CAAAC,KAAA,CAAAC,cAAA,CAAAC,OAAA;UACAD,cAAA,CAAAyB,OAAA,YAAA3B,IAAA,CAAA4B,SAAA;YACA,GAAAF,UAAA;YACA,GAAAJ,UAAA;YACApD,QAAA;UACA;QACA;MACA,SAAA0C,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA,CAAAA,KAAA,CAAAiB,QAAA,EAAAlF,IAAA,EAAAmF,GAAA;MACA;IACA;IACAC,iBAAA;MACA,KAAAhE,mBAAA;IACA;IACAiE,iBAAAC,IAAA;MACA,MAAAC,OAAA,GAAAD,IAAA,CAAAE,GAAA,CAAAC,IAAA,CAAAC,UAAA;MACA,MAAAC,MAAA,GAAAL,IAAA,CAAAM,IAAA;MAEA,KAAAL,OAAA;QACA,KAAArB,QAAA,CAAAD,KAAA;QACA;MACA;MACA,KAAA0B,MAAA;QACA,KAAAzB,QAAA,CAAAD,KAAA;QACA;MACA;MAEA,KAAA5C,aAAA,GAAAwE,GAAA,CAAAC,eAAA,CAAAR,IAAA,CAAAE,GAAA;MACA,KAAAO,UAAA,GAAAT,IAAA,CAAAE,GAAA;IACA;IAEA,MAAAQ,aAAA;MACA,UAAAD,UAAA;QACA,KAAA7B,QAAA,CAAA+B,OAAA;QACA;MACA;MAEA;QACA,KAAA3E,SAAA;QACA,MAAA4E,QAAA,OAAAC,QAAA;QACAD,QAAA,CAAAE,MAAA,cAAAL,UAAA;QACAG,QAAA,CAAAE,MAAA,gBAAA/F,QAAA,CAAAC,EAAA;QAEA,MAAAM,GAAA,cAAAL,MAAA,CAAAsE,IAAA,CACA,KAAApE,QAAA,yBACAyF,QAAA,EACA;UACAG,OAAA;YACA;UACA;QACA,CACA;QACA,IAAAzF,GAAA,CAAAZ,IAAA,CAAAa,IAAA;UACA,KAAAR,QAAA,CAAAsB,MAAA,GAAAf,GAAA,CAAAZ,IAAA,CAAAA,IAAA;UACA,KAAAkE,QAAA,CAAAY,OAAA;UACA,KAAA1D,mBAAA;UACA;UACA,MAAA2D,UAAA,GAAA1B,IAAA,CAAAC,KAAA,CAAAC,cAAA,CAAAC,OAAA;UACAuB,UAAA,CAAApD,MAAA,GAAAf,GAAA,CAAAZ,IAAA,CAAAA,IAAA;UACAuD,cAAA,CAAAyB,OAAA,YAAA3B,IAAA,CAAA4B,SAAA,CAAAF,UAAA;QACA;MACA,SAAAd,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;QACA,KAAA3C,SAAA;MACA;IACA;IACAgF,WAAA;MACA,KAAAC,OAAA,CAAAC,IAAA;IACA;IACAC,gBAAA;MACA,KAAAF,OAAA,CAAAC,IAAA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}