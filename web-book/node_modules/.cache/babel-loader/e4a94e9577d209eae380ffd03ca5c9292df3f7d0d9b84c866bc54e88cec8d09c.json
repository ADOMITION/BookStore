{"ast":null,"code":"import { formatDate } from \"@/store/formatDate\";\nexport default {\n  data() {\n    return {\n      loading: false,\n      announcementList: [],\n      total: 0,\n      pagination: {\n        pageNum: 1,\n        pageSize: 10\n      },\n      searchForm: {\n        title: \"\"\n      },\n      dialogVisible: false,\n      dialogTitle: \"\",\n      form: {\n        id: null,\n        title: \"\",\n        content: \"\",\n        adminId: null\n      },\n      rules: {\n        title: [{\n          required: true,\n          message: \"请输入标题\",\n          trigger: \"blur\"\n        }],\n        content: [{\n          required: true,\n          message: \"请输入内容\",\n          trigger: \"blur\"\n        }],\n        adminId: [{\n          required: true,\n          message: \"请选择管理员\",\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  created() {\n    this.loadAnnouncements();\n  },\n  methods: {\n    async loadAnnouncements() {\n      this.loading = true;\n      try {\n        const params = {\n          pageNum: this.pagination.pageNum,\n          pageSize: this.pagination.pageSize,\n          param: this.searchForm\n        };\n        const res = await this.$axios.post(this.$httpUrl + '/announcement/listPage', params);\n        ;\n        if (res.data.code === 200) {\n          this.announcementList = res.data.data;\n          this.total = res.data.total;\n        }\n      } catch (error) {\n        this.$message.error(\"获取公告列表失败\");\n      } finally {\n        this.loading = false;\n      }\n    },\n    formatTime(time) {\n      if (!time) return \"暂无时间信息\";\n      try {\n        const dateStr = typeof time === \"string\" ? time : time.toString();\n        return formatDate(new Date(dateStr), \"yyyy-MM-dd hh:mm:ss\");\n      } catch (e) {\n        console.error(\"时间格式错误:\", time);\n        return \"时间格式异常\";\n      }\n    },\n    resetSearch() {\n      this.searchForm = {\n        title: \"\"\n      };\n      this.pagination.pageNum = 1;\n      this.loadAnnouncements();\n    },\n    handleSizeChange(val) {\n      this.pagination.pageSize = val;\n      this.loadAnnouncements();\n    },\n    handleCurrentChange(val) {\n      this.pagination.pageNum = val;\n      this.loadAnnouncements();\n    },\n    handleCreate() {\n      this.form = {\n        id: null,\n        title: \"\",\n        content: \"\",\n        adminId: null\n      };\n      this.dialogTitle = \"新增公告\";\n      this.dialogVisible = true;\n    },\n    handleEdit(row) {\n      this.form = {\n        ...row\n      };\n      this.dialogTitle = \"编辑公告\";\n      this.dialogVisible = true;\n    },\n    async handleDelete(id) {\n      this.$confirm(\"确认删除该公告？\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(async () => {\n        try {\n          const res = await this.$axios.get(this.$httpUrl + '/announcement/delete', {\n            params: {\n              id\n            }\n          });\n          if (res.data.code === 200) {\n            this.$message.success(\"删除成功\");\n            this.loadAnnouncements();\n          } else {\n            this.$message.error(res.data.msg || \"删除失败\");\n          }\n        } catch (error) {\n          this.$message.error(\"删除操作失败\");\n        }\n      });\n    },\n    async submitForm() {\n      this.$refs.form.validate(async valid => {\n        if (valid) {\n          try {\n            const isEdit = !!this.form.id;\n            const url = isEdit ? '/announcement/update' : '/announcement/add';\n            const res = await this.$axios.post(this.$httpUrl + url, this.form);\n            if (res.data.code === 200) {\n              this.$message.success(isEdit ? \"修改成功\" : \"新增成功\");\n              this.dialogVisible = false;\n              this.loadAnnouncements();\n            } else {\n              this.$message.error(res.data.msg || \"操作失败\");\n            }\n          } catch (error) {\n            this.$message.error(\"请求失败，请检查网络\");\n          }\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["formatDate","data","loading","announcementList","total","pagination","pageNum","pageSize","searchForm","title","dialogVisible","dialogTitle","form","id","content","adminId","rules","required","message","trigger","created","loadAnnouncements","methods","params","param","res","$axios","post","$httpUrl","code","error","$message","formatTime","time","dateStr","toString","Date","e","console","resetSearch","handleSizeChange","val","handleCurrentChange","handleCreate","handleEdit","row","handleDelete","$confirm","confirmButtonText","cancelButtonText","type","then","get","success","msg","submitForm","$refs","validate","valid","isEdit","url"],"sources":["src/admin/AnnouncementManage.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-card>\r\n      <!-- 搜索栏 -->\r\n      <div class=\"filter-container\">\r\n        <el-input\r\n            v-model=\"searchForm.title\"\r\n            placeholder=\"输入公告标题\"\r\n            clearable\r\n            prefix-icon=\"el-icon-notebook-1\"\r\n            style=\"width: 200px; margin-right: 10px;\"\r\n            @keyup.enter.native=\"loadAnnouncements\"\r\n        />\r\n        <div class=\"operation-btns\">\r\n          <el-button\r\n              type=\"primary\"\r\n              icon=\"el-icon-search\"\r\n              @click=\"loadAnnouncements\"\r\n          >查询</el-button>\r\n          <el-button\r\n              icon=\"el-icon-refresh\"\r\n              @click=\"resetSearch\"\r\n          >重置</el-button>\r\n          <el-button\r\n              type=\"success\"\r\n              icon=\"el-icon-plus\"\r\n              @click=\"handleCreate\"\r\n          >新增公告</el-button>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 公告表格 -->\r\n      <el-table\r\n          :data=\"announcementList\"\r\n          v-loading=\"loading\"\r\n          border\r\n          fit\r\n          highlight-current-row\r\n          style=\"width: 100%; margin-top: 20px;\"\r\n      >\r\n        <el-table-column prop=\"title\" label=\"公告标题\" width=\"180\" />\r\n        <el-table-column prop=\"content\" label=\"公告内容\" min-width=\"250\">\r\n          <template slot-scope=\"{row}\">\r\n            <div class=\"content-box\">{{ row.content }}</div>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"创建时间\" width=\"180\" align=\"center\">\r\n          <template slot-scope=\"{row}\">\r\n            {{ formatTime(row.createtime) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"adminId\" label=\"管理员ID\" width=\"120\" align=\"center\" />\r\n\r\n        <el-table-column label=\"操作\" width=\"180\" align=\"center\">\r\n          <template slot-scope=\"{row}\">\r\n            <div class=\"action-btns\">\r\n              <el-button\r\n                  type=\"text\"\r\n                  size=\"small\"\r\n                  @click=\"handleEdit(row)\"\r\n                  icon=\"el-icon-edit\"\r\n              >编辑</el-button>\r\n              <el-button\r\n                  type=\"text\"\r\n                  size=\"small\"\r\n                  @click=\"handleDelete(row.id)\"\r\n                  icon=\"el-icon-delete\"\r\n                  class=\"delete-btn\"\r\n              >删除</el-button>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!-- 分页 -->\r\n      <div class=\"pagination-container\">\r\n        <el-pagination\r\n            background\r\n            :current-page=\"pagination.pageNum\"\r\n            :page-sizes=\"[10, 20, 30, 50]\"\r\n            :page-size=\"pagination.pageSize\"\r\n            layout=\"total, sizes, prev, pager, next, jumper\"\r\n            :total=\"total\"\r\n            @size-change=\"handleSizeChange\"\r\n            @current-change=\"handleCurrentChange\"\r\n        />\r\n      </div>\r\n\r\n      <!-- 编辑对话框 -->\r\n      <el-dialog\r\n          :title=\"dialogTitle\"\r\n          :visible.sync=\"dialogVisible\"\r\n          width=\"600px\"\r\n      >\r\n        <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\r\n          <el-form-item label=\"标题\" prop=\"title\">\r\n            <el-input v-model=\"form.title\" />\r\n          </el-form-item>\r\n          <el-form-item label=\"内容\" prop=\"content\">\r\n            <el-input v-model=\"form.content\" type=\"textarea\" rows=\"5\" />\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\">\r\n          <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"submitForm\">确认</el-button>\r\n        </div>\r\n      </el-dialog>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { formatDate } from \"@/store/formatDate\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      announcementList: [],\r\n      total: 0,\r\n      pagination: {\r\n        pageNum: 1,\r\n        pageSize: 10\r\n      },\r\n      searchForm: {\r\n        title: \"\"\r\n      },\r\n      dialogVisible: false,\r\n      dialogTitle: \"\",\r\n      form: {\r\n        id: null,\r\n        title: \"\",\r\n        content: \"\",\r\n        adminId: null\r\n      },\r\n      rules: {\r\n        title: [{ required: true, message: \"请输入标题\", trigger: \"blur\" }],\r\n        content: [{ required: true, message: \"请输入内容\", trigger: \"blur\" }],\r\n        adminId: [{ required: true, message: \"请选择管理员\", trigger: \"blur\" }]\r\n      }\r\n    };\r\n  },\r\n  created() {\r\n    this.loadAnnouncements();\r\n  },\r\n  methods: {\r\n    async loadAnnouncements() {\r\n      this.loading = true;\r\n      try {\r\n        const params = {\r\n          pageNum: this.pagination.pageNum,\r\n          pageSize: this.pagination.pageSize,\r\n          param: this.searchForm\r\n        };\r\n        const res = await this.$axios.post(this.$httpUrl+'/announcement/listPage', params);;\r\n        if (res.data.code === 200) {\r\n          this.announcementList = res.data.data;\r\n          this.total = res.data.total;\r\n        }\r\n      } catch (error) {\r\n        this.$message.error(\"获取公告列表失败\");\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    formatTime(time) {\r\n      if (!time) return \"暂无时间信息\";\r\n      try {\r\n        const dateStr = typeof time === \"string\" ? time : time.toString();\r\n        return formatDate(new Date(dateStr), \"yyyy-MM-dd hh:mm:ss\");\r\n      } catch (e) {\r\n        console.error(\"时间格式错误:\", time);\r\n        return \"时间格式异常\";\r\n      }\r\n    },\r\n\r\n    resetSearch() {\r\n      this.searchForm = { title: \"\" };\r\n      this.pagination.pageNum = 1;\r\n      this.loadAnnouncements();\r\n    },\r\n\r\n    handleSizeChange(val) {\r\n      this.pagination.pageSize = val;\r\n      this.loadAnnouncements();\r\n    },\r\n\r\n    handleCurrentChange(val) {\r\n      this.pagination.pageNum = val;\r\n      this.loadAnnouncements();\r\n    },\r\n\r\n    handleCreate() {\r\n      this.form = { id: null, title: \"\", content: \"\", adminId: null };\r\n      this.dialogTitle = \"新增公告\";\r\n      this.dialogVisible = true;\r\n    },\r\n\r\n    handleEdit(row) {\r\n      this.form = { ...row };\r\n      this.dialogTitle = \"编辑公告\";\r\n      this.dialogVisible = true;\r\n    },\r\n\r\n    async handleDelete(id) {\r\n      this.$confirm(\"确认删除该公告？\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\"\r\n      }).then(async () => {\r\n        try {\r\n          const res = await this.$axios.get(this.$httpUrl+'/announcement/delete', {\r\n            params: { id }\r\n          });\r\n\r\n          if (res.data.code === 200) {\r\n            this.$message.success(\"删除成功\");\r\n            this.loadAnnouncements();\r\n          } else {\r\n            this.$message.error(res.data.msg || \"删除失败\");\r\n          }\r\n        } catch (error) {\r\n          this.$message.error(\"删除操作失败\");\r\n        }\r\n      });\r\n    },\r\n\r\n    async submitForm() {\r\n      this.$refs.form.validate(async valid => {\r\n        if (valid) {\r\n          try {\r\n            const isEdit = !!this.form.id;\r\n            const url = isEdit ? '/announcement/update' : '/announcement/add';\r\n\r\n            const res = await this.$axios.post(this.$httpUrl+url, this.form);\r\n\r\n            if (res.data.code === 200) {\r\n              this.$message.success(isEdit ? \"修改成功\" : \"新增成功\");\r\n              this.dialogVisible = false;\r\n              this.loadAnnouncements();\r\n            } else {\r\n              this.$message.error(res.data.msg || \"操作失败\");\r\n            }\r\n          } catch (error) {\r\n            this.$message.error(\"请求失败，请检查网络\");\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.app-container {\r\n  padding: 24px;\r\n  background: linear-gradient(135deg, #f8f9fc 0%, #f1f3f9 100%);\r\n  min-height: calc(100vh - 84px);\r\n\r\n  .filter-container {\r\n    background: rgba(255, 255, 255, 0.95);\r\n    border-radius: 12px;\r\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);\r\n    margin-bottom: 24px;\r\n    padding: 20px 24px;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 16px;\r\n\r\n    .operation-btns {\r\n      margin-left: auto;\r\n      display: flex;\r\n      gap: 12px;\r\n\r\n      .el-button {\r\n        padding: 10px 20px;\r\n        border-radius: 8px;\r\n        font-weight: 500;\r\n\r\n        &[type=\"primary\"] {\r\n          background: linear-gradient(135deg, #409eff, #3375e0);\r\n        }\r\n\r\n        &[type=\"success\"] {\r\n          background: linear-gradient(135deg, #67c23a, #4a9b20);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .el-table {\r\n    background: rgba(255, 255, 255, 0.95);\r\n    border-radius: 12px;\r\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);\r\n\r\n    .content-box {\r\n      line-height: 1.6;\r\n      max-height: 60px;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      display: -webkit-box;\r\n      -webkit-line-clamp: 3;\r\n      -webkit-box-orient: vertical;\r\n    }\r\n\r\n    .action-btns .delete-btn {\r\n      color: #f56c6c;\r\n      &:hover {\r\n        color: darken(#f56c6c, 10%);\r\n      }\r\n    }\r\n  }\r\n\r\n  .el-dialog {\r\n    border-radius: 12px;\r\n    .el-form-item__content {\r\n      .el-textarea__inner {\r\n        min-height: 120px !important;\r\n      }\r\n    }\r\n  }\r\n\r\n  .pagination-container {\r\n    margin-top: 20px;\r\n    padding: 20px;\r\n    background: rgba(255, 255, 255, 0.95);\r\n    border-radius: 12px;\r\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);\r\n  }\r\n}\r\n</style>"],"mappings":"AAgHA,SAAAA,UAAA;AAEA;EACAC,KAAA;IACA;MACAC,OAAA;MACAC,gBAAA;MACAC,KAAA;MACAC,UAAA;QACAC,OAAA;QACAC,QAAA;MACA;MACAC,UAAA;QACAC,KAAA;MACA;MACAC,aAAA;MACAC,WAAA;MACAC,IAAA;QACAC,EAAA;QACAJ,KAAA;QACAK,OAAA;QACAC,OAAA;MACA;MACAC,KAAA;QACAP,KAAA;UAAAQ,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAL,OAAA;UAAAG,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;QACAJ,OAAA;UAAAE,QAAA;UAAAC,OAAA;UAAAC,OAAA;QAAA;MACA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,iBAAA;EACA;EACAC,OAAA;IACA,MAAAD,kBAAA;MACA,KAAAnB,OAAA;MACA;QACA,MAAAqB,MAAA;UACAjB,OAAA,OAAAD,UAAA,CAAAC,OAAA;UACAC,QAAA,OAAAF,UAAA,CAAAE,QAAA;UACAiB,KAAA,OAAAhB;QACA;QACA,MAAAiB,GAAA,cAAAC,MAAA,CAAAC,IAAA,MAAAC,QAAA,6BAAAL,MAAA;QAAA;QACA,IAAAE,GAAA,CAAAxB,IAAA,CAAA4B,IAAA;UACA,KAAA1B,gBAAA,GAAAsB,GAAA,CAAAxB,IAAA,CAAAA,IAAA;UACA,KAAAG,KAAA,GAAAqB,GAAA,CAAAxB,IAAA,CAAAG,KAAA;QACA;MACA,SAAA0B,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;QACA,KAAA5B,OAAA;MACA;IACA;IAEA8B,WAAAC,IAAA;MACA,KAAAA,IAAA;MACA;QACA,MAAAC,OAAA,UAAAD,IAAA,gBAAAA,IAAA,GAAAA,IAAA,CAAAE,QAAA;QACA,OAAAnC,UAAA,KAAAoC,IAAA,CAAAF,OAAA;MACA,SAAAG,CAAA;QACAC,OAAA,CAAAR,KAAA,YAAAG,IAAA;QACA;MACA;IACA;IAEAM,YAAA;MACA,KAAA/B,UAAA;QAAAC,KAAA;MAAA;MACA,KAAAJ,UAAA,CAAAC,OAAA;MACA,KAAAe,iBAAA;IACA;IAEAmB,iBAAAC,GAAA;MACA,KAAApC,UAAA,CAAAE,QAAA,GAAAkC,GAAA;MACA,KAAApB,iBAAA;IACA;IAEAqB,oBAAAD,GAAA;MACA,KAAApC,UAAA,CAAAC,OAAA,GAAAmC,GAAA;MACA,KAAApB,iBAAA;IACA;IAEAsB,aAAA;MACA,KAAA/B,IAAA;QAAAC,EAAA;QAAAJ,KAAA;QAAAK,OAAA;QAAAC,OAAA;MAAA;MACA,KAAAJ,WAAA;MACA,KAAAD,aAAA;IACA;IAEAkC,WAAAC,GAAA;MACA,KAAAjC,IAAA;QAAA,GAAAiC;MAAA;MACA,KAAAlC,WAAA;MACA,KAAAD,aAAA;IACA;IAEA,MAAAoC,aAAAjC,EAAA;MACA,KAAAkC,QAAA;QACAC,iBAAA;QACAC,gBAAA;QACAC,IAAA;MACA,GAAAC,IAAA;QACA;UACA,MAAA1B,GAAA,cAAAC,MAAA,CAAA0B,GAAA,MAAAxB,QAAA;YACAL,MAAA;cAAAV;YAAA;UACA;UAEA,IAAAY,GAAA,CAAAxB,IAAA,CAAA4B,IAAA;YACA,KAAAE,QAAA,CAAAsB,OAAA;YACA,KAAAhC,iBAAA;UACA;YACA,KAAAU,QAAA,CAAAD,KAAA,CAAAL,GAAA,CAAAxB,IAAA,CAAAqD,GAAA;UACA;QACA,SAAAxB,KAAA;UACA,KAAAC,QAAA,CAAAD,KAAA;QACA;MACA;IACA;IAEA,MAAAyB,WAAA;MACA,KAAAC,KAAA,CAAA5C,IAAA,CAAA6C,QAAA,OAAAC,KAAA;QACA,IAAAA,KAAA;UACA;YACA,MAAAC,MAAA,UAAA/C,IAAA,CAAAC,EAAA;YACA,MAAA+C,GAAA,GAAAD,MAAA;YAEA,MAAAlC,GAAA,cAAAC,MAAA,CAAAC,IAAA,MAAAC,QAAA,GAAAgC,GAAA,OAAAhD,IAAA;YAEA,IAAAa,GAAA,CAAAxB,IAAA,CAAA4B,IAAA;cACA,KAAAE,QAAA,CAAAsB,OAAA,CAAAM,MAAA;cACA,KAAAjD,aAAA;cACA,KAAAW,iBAAA;YACA;cACA,KAAAU,QAAA,CAAAD,KAAA,CAAAL,GAAA,CAAAxB,IAAA,CAAAqD,GAAA;YACA;UACA,SAAAxB,KAAA;YACA,KAAAC,QAAA,CAAAD,KAAA;UACA;QACA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}