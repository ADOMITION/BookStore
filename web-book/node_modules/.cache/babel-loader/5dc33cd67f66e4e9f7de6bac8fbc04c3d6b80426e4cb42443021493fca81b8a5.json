{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nexport default {\n  data() {\n    return {\n      cartItems: [],\n      selectedItems: []\n    };\n  },\n  computed: {\n    // 计算原始总价\n    originalTotal() {\n      return this.selectedItems.reduce((sum, item) => {\n        return sum + item.book.price * item.quantity;\n      }, 0);\n    },\n    // 计算折扣总价\n    totalPrice() {\n      return this.selectedItems.reduce((sum, item) => {\n        return sum + this.calculateDiscountPrice(item.book) * item.quantity;\n      }, 0);\n    },\n    // 计算总优惠金额\n    discountAmount() {\n      return this.originalTotal - this.totalPrice;\n    }\n  },\n  created() {\n    this.loadCart();\n  },\n  methods: {\n    // 折扣计算逻辑（与详情页保持一致）\n    calculateDiscountPrice(book) {\n      if (book.stock > 25) return book.price * 0.7;\n      if (book.stock >= 20) return book.price * 0.8;\n      if (book.stock >= 15) return book.price * 0.9;\n      return book.price;\n    },\n    // 折扣标签显示\n    calculateDiscountTag(stock) {\n      if (stock > 25) return '七折';\n      if (stock >= 20) return '八折';\n      if (stock >= 15) return '九折';\n      return '';\n    },\n    async loadCart() {\n      try {\n        const {\n          data\n        } = await this.$axios.get(this.$httpUrl + \"/cart/list\");\n        if (data.code === 200) {\n          this.cartItems = data.data.map(item => ({\n            ...item,\n            quantity: item.quantity\n          }));\n        }\n      } catch (error) {\n        this.$message.error(\"获取购物车失败\");\n      }\n    },\n    async updateQuantity(item) {\n      try {\n        await this.$axios.post(this.$httpUrl + \"/cart/update\", {\n          bookId: item.book.id,\n          quantity: item.quantity\n        });\n      } catch (error) {\n        this.$message.error(\"更新数量失败\");\n      }\n    },\n    async deleteItem(item) {\n      try {\n        await this.$axios.post(this.$httpUrl + \"/cart/delete\", {\n          bookId: item.book.id\n        });\n        this.loadCart();\n      } catch (error) {\n        this.$message.error(\"删除失败\");\n      }\n    },\n    handleSelectionChange(selection) {\n      this.selectedItems = selection;\n    },\n    async clearCart() {\n      try {\n        await this.$axios.post(this.$httpUrl + \"/cart/clear\");\n        this.loadCart();\n        this.$message.success(\"购物车已清空\");\n      } catch (error) {\n        this.$message.error(\"清空失败\");\n      }\n    },\n    checkout() {\n      if (!this.check()) return;\n      const selectedItems = this.selectedItems.map(item => ({\n        pid: item.book.id,\n        num: item.quantity\n      }));\n      this.$axios.post(this.$httpUrl + '/order/batchBuy', selectedItems).then(response => {\n        const oiids = response.data.data;\n        this.$router.push({\n          path: '/confirm',\n          query: {\n            oiids: JSON.stringify(oiids),\n            type: 'batch'\n          }\n        });\n      });\n    },\n    check() {\n      if (!sessionStorage.getItem('CurUser')) {\n        this.$message.warning(\"您还未登录哦，请先登录\");\n        return false;\n      }\n      return true;\n    }\n  }\n};","map":{"version":3,"names":["data","cartItems","selectedItems","computed","originalTotal","reduce","sum","item","book","price","quantity","totalPrice","calculateDiscountPrice","discountAmount","created","loadCart","methods","stock","calculateDiscountTag","$axios","get","$httpUrl","code","map","error","$message","updateQuantity","post","bookId","id","deleteItem","handleSelectionChange","selection","clearCart","success","checkout","check","pid","num","then","response","oiids","$router","push","path","query","JSON","stringify","type","sessionStorage","getItem","warning"],"sources":["src/user/CartPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"cart-container\">\r\n    <el-card class=\"cart-card\">\r\n      <!-- 购物车头部 -->\r\n      <div slot=\"header\" class=\"cart-header\">\r\n        <h2><i class=\"el-icon-shopping-cart-full\"></i> 我的购物车</h2>\r\n        <el-button\r\n            type=\"danger\"\r\n            :disabled=\"selectedItems.length === 0\"\r\n            @click=\"clearCart\"\r\n        >\r\n          清空购物车\r\n        </el-button>\r\n      </div>\r\n\r\n      <!-- 购物车列表 -->\r\n      <el-table\r\n          :data=\"cartItems\"\r\n          stripe\r\n          @selection-change=\"handleSelectionChange\"\r\n      >\r\n        <el-table-column type=\"selection\" width=\"55\"></el-table-column>\r\n\r\n        <el-table-column label=\"商品信息\" width=\"400\">\r\n          <template slot-scope=\"{row}\">\r\n            <div class=\"product-info\">\r\n              <el-image\r\n                  :src=\"row.book.url || require('@/assets/default-book.png')\"\r\n                  class=\"product-image\"\r\n              ></el-image>\r\n              <div class=\"product-detail\">\r\n                <div class=\"title\">{{ row.book.name }}</div>\r\n                <div class=\"author\">{{ row.book.author }}</div>\r\n                <div class=\"press\">{{ row.book.press }}</div>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column label=\"单价\" width=\"120\">\r\n          <template slot-scope=\"{row}\">\r\n            <div class=\"price-group\">\r\n              <span class=\"original-price\">¥{{ row.book.price.toFixed(2) }}</span>\r\n              <span class=\"discount-price\">¥{{ calculateDiscountPrice(row.book).toFixed(2) }}</span>\r\n            </div>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column label=\"数量\" width=\"150\">\r\n          <template slot-scope=\"{row}\">\r\n            <el-input-number\r\n                v-model=\"row.quantity\"\r\n                :min=\"1\"\r\n                :max=\"row.book.stock\"\r\n                @change=\"updateQuantity(row)\"\r\n            ></el-input-number>\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column label=\"小计\" width=\"120\">\r\n          <template slot-scope=\"{row}\">\r\n            ¥{{ (calculateDiscountPrice(row.book) * row.quantity).toFixed(2) }}\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column label=\"操作\" width=\"80\">\r\n          <template slot-scope=\"{row}\">\r\n            <el-button\r\n                type=\"text\"\r\n                class=\"delete-btn\"\r\n                @click=\"deleteItem(row)\"\r\n            >\r\n              删除\r\n            </el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!-- 结算栏 -->\r\n      <div class=\"checkout-bar\">\r\n        <div class=\"total\">\r\n          已选 {{ selectedItems.length }} 件商品，总金额：\r\n          <div class=\"price-summary\">\r\n            <div>商品总价：¥{{ originalTotal.toFixed(2) }}</div>\r\n            <div>折扣优惠：-¥{{ discountAmount.toFixed(2) }}</div>\r\n            <div class=\"grand-total\">应付总额：¥{{ totalPrice.toFixed(2) }}</div>\r\n          </div>\r\n        </div>\r\n        <el-button\r\n            type=\"danger\"\r\n            size=\"large\"\r\n            :disabled=\"selectedItems.length === 0\"\r\n            @click=\"checkout\"\r\n        >\r\n          去结算\r\n        </el-button>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      cartItems: [],\r\n      selectedItems: []\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    // 计算原始总价\r\n    originalTotal() {\r\n      return this.selectedItems.reduce((sum, item) => {\r\n        return sum + (item.book.price * item.quantity)\r\n      }, 0)\r\n    },\r\n    // 计算折扣总价\r\n    totalPrice() {\r\n      return this.selectedItems.reduce((sum, item) => {\r\n        return sum + (this.calculateDiscountPrice(item.book) * item.quantity)\r\n      }, 0)\r\n    },\r\n    // 计算总优惠金额\r\n    discountAmount() {\r\n      return this.originalTotal - this.totalPrice\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.loadCart();\r\n  },\r\n\r\n  methods: {\r\n    // 折扣计算逻辑（与详情页保持一致）\r\n    calculateDiscountPrice(book) {\r\n      if (book.stock > 25) return book.price * 0.7\r\n      if (book.stock >= 20) return book.price * 0.8\r\n      if (book.stock >= 15) return book.price * 0.9\r\n      return book.price\r\n    },\r\n    // 折扣标签显示\r\n    calculateDiscountTag(stock) {\r\n      if (stock > 25) return '七折'\r\n      if (stock >= 20) return '八折'\r\n      if (stock >= 15) return '九折'\r\n      return ''\r\n    },\r\n\r\n    async loadCart() {\r\n      try {\r\n        const { data } = await this.$axios.get(this.$httpUrl + \"/cart/list\");\r\n        if (data.code === 200) {\r\n          this.cartItems = data.data.map(item => ({\r\n            ...item,\r\n            quantity: item.quantity\r\n          }));\r\n        }\r\n      } catch (error) {\r\n        this.$message.error(\"获取购物车失败\");\r\n      }\r\n    },\r\n\r\n    async updateQuantity(item) {\r\n      try {\r\n        await this.$axios.post(this.$httpUrl + \"/cart/update\", {\r\n          bookId: item.book.id,\r\n          quantity: item.quantity\r\n        });\r\n      } catch (error) {\r\n        this.$message.error(\"更新数量失败\");\r\n      }\r\n    },\r\n\r\n    async deleteItem(item) {\r\n      try {\r\n        await this.$axios.post(this.$httpUrl + \"/cart/delete\", {\r\n          bookId: item.book.id\r\n        });\r\n        this.loadCart();\r\n      } catch (error) {\r\n        this.$message.error(\"删除失败\");\r\n      }\r\n    },\r\n\r\n    handleSelectionChange(selection) {\r\n      this.selectedItems = selection;\r\n    },\r\n\r\n    async clearCart() {\r\n      try {\r\n        await this.$axios.post(this.$httpUrl + \"/cart/clear\");\r\n        this.loadCart();\r\n        this.$message.success(\"购物车已清空\");\r\n      } catch (error) {\r\n        this.$message.error(\"清空失败\");\r\n      }\r\n    },\r\n\r\n    checkout() {\r\n      if (!this.check()) return\r\n      const selectedItems = this.selectedItems.map(item => ({\r\n        pid: item.book.id,\r\n        num: item.quantity\r\n      }));\r\n\r\n      this.$axios.post(this.$httpUrl + '/order/batchBuy', selectedItems)\r\n          .then(response => {\r\n            const oiids = response.data.data;\r\n            this.$router.push({\r\n              path: '/confirm',\r\n              query: {\r\n                oiids: JSON.stringify(oiids),\r\n                type: 'batch'\r\n              }\r\n            });\r\n          })\r\n    },\r\n    check() {\r\n      if (!sessionStorage.getItem('CurUser')) {\r\n        this.$message.warning(\"您还未登录哦，请先登录\");\r\n        return false\r\n      }\r\n      return true\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.cart-container {\r\n  padding: 30px 15%;\r\n}\r\n\r\n.cart-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.product-info {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.product-image {\r\n  width: 80px;\r\n  height: 100px;\r\n  margin-right: 20px;\r\n}\r\n\r\n.product-detail .title {\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.product-detail .author,\r\n.product-detail .press {\r\n  color: #666;\r\n  font-size: 12px;\r\n}\r\n\r\n.checkout-bar {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 20px;\r\n  background: #f5f7fa;\r\n}\r\n\r\n.delete-btn {\r\n  color: #f56c6c;\r\n}\r\n.price-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.original-price {\r\n  font-size: 12px;\r\n  color: #999;\r\n  text-decoration: line-through;\r\n}\r\n\r\n.discount-price {\r\n  color: #f56c6c;\r\n  font-weight: bold;\r\n  font-size: 16px;\r\n}\r\n\r\n.discount-tag {\r\n  background: linear-gradient(45deg, #ff6b6b, #ff4444);\r\n  color: white;\r\n  padding: 2px 8px;\r\n  border-radius: 4px;\r\n  font-size: 12px;\r\n  margin-top: 5px;\r\n  display: inline-block;\r\n}\r\n\r\n.price-summary {\r\n  text-align: right;\r\n  margin-top: 10px;\r\n}\r\n\r\n.grand-total {\r\n  font-size: 18px;\r\n  color: #f56c6c;\r\n  font-weight: bold;\r\n  margin-top: 10px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}