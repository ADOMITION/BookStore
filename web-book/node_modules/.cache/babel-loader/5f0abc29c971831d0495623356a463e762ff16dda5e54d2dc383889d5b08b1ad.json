{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nexport default {\n  data() {\n    return {\n      cartItems: []\n    };\n  },\n  computed: {\n    totalPrice() {\n      return this.cartItems.reduce((sum, item) => {\n        return sum + item.book.price * item.quantity;\n      }, 0);\n    }\n  },\n  created() {\n    this.loadCart();\n  },\n  methods: {\n    async loadCart() {\n      try {\n        const {\n          data\n        } = await this.$axios.get(this.$httpUrl + '/cart/list');\n        if (data.code === 200) {\n          this.cartItems = data.data;\n        }\n      } catch (error) {\n        this.$message.error('获取购物车失败');\n      }\n    },\n    async handleQuantityChange(item) {\n      try {\n        const {\n          data\n        } = await this.$axios.put(this.$httpUrl + `/cart/update?pid=${item.bookId}&num=${item.quantity}`);\n        if (data.code !== 200) {\n          this.$message.error('更新失败');\n          this.loadCart(); // 重新加载数据\n        }\n      } catch (error) {\n        this.$message.error('更新失败');\n        this.loadCart();\n      }\n    },\n    async handleDelete(item) {\n      try {\n        await this.$axios.delete(this.$httpUrl + `/cart/delete?pid=${item.bookId}`);\n        this.$message.success('删除成功');\n        this.loadCart();\n      } catch (error) {\n        this.$message.error('删除失败');\n      }\n    },\n    handleCheckout() {\n      if (!this.checkLogin()) return;\n      if (this.cartItems.length === 0) return;\n      this.$router.push('/confirm');\n    },\n    checkLogin() {\n      if (!sessionStorage.getItem('CurUser')) {\n        this.$router.push('/login');\n        return false;\n      }\n      return true;\n    }\n  }\n};","map":{"version":3,"names":["data","cartItems","computed","totalPrice","reduce","sum","item","book","price","quantity","created","loadCart","methods","$axios","get","$httpUrl","code","error","$message","handleQuantityChange","put","bookId","handleDelete","delete","success","handleCheckout","checkLogin","length","$router","push","sessionStorage","getItem"],"sources":["src/user/CartPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"cart-container\">\r\n    <el-row>\r\n      <el-col :span=\"20\" :offset=\"2\">\r\n        <h2 class=\"cart-title\">我的购物车</h2>\r\n\r\n        <!-- 购物车列表 -->\r\n        <div v-if=\"cartItems.length > 0\">\r\n          <el-table :data=\"cartItems\" style=\"width: 100%\">\r\n            <el-table-column label=\"商品信息\" width=\"400\">\r\n              <template slot-scope=\"scope\">\r\n                <div class=\"product-info\">\r\n                  <el-image\r\n                      :src=\"scope.row.book.url\"\r\n                      class=\"product-image\"\r\n                      fit=\"contain\"\r\n                  ></el-image>\r\n                  <div class=\"product-meta\">\r\n                    <h3>{{ scope.row.book.name }}</h3>\r\n                    <p class=\"author\">{{ scope.row.book.author }}</p>\r\n                  </div>\r\n                </div>\r\n              </template>\r\n            </el-table-column>\r\n\r\n            <el-table-column label=\"单价\" width=\"120\">\r\n              <template slot-scope=\"scope\">\r\n                ¥{{ scope.row.book.price.toFixed(2) }}\r\n              </template>\r\n            </el-table-column>\r\n\r\n            <el-table-column label=\"数量\" width=\"180\">\r\n              <template slot-scope=\"scope\">\r\n                <el-input-number\r\n                    v-model=\"scope.row.quantity\"\r\n                    :min=\"1\"\r\n                    :max=\"scope.row.book.stock\"\r\n                    @change=\"handleQuantityChange(scope.row)\"\r\n                ></el-input-number>\r\n              </template>\r\n            </el-table-column>\r\n\r\n            <el-table-column label=\"小计\" width=\"120\">\r\n              <template slot-scope=\"scope\">\r\n                ¥{{ (scope.row.book.price * scope.row.quantity).toFixed(2) }}\r\n              </template>\r\n            </el-table-column>\r\n\r\n            <el-table-column label=\"操作\">\r\n              <template slot-scope=\"scope\">\r\n                <el-button\r\n                    type=\"danger\"\r\n                    icon=\"el-icon-delete\"\r\n                    @click=\"handleDelete(scope.row)\"\r\n                >删除</el-button>\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n\r\n          <!-- 汇总信息 -->\r\n          <div class=\"summary\">\r\n            <div class=\"total\">\r\n              总计：¥{{ totalPrice.toFixed(2) }}\r\n            </div>\r\n            <el-button\r\n                type=\"danger\"\r\n                size=\"large\"\r\n                @click=\"handleCheckout\"\r\n            >去结算</el-button>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 空购物车提示 -->\r\n        <div v-else class=\"empty-cart\">\r\n          <el-empty description=\"购物车空空如也，快去挑选好书吧~\">\r\n            <el-button type=\"primary\" @click=\"$router.push('/')\">去逛逛</el-button>\r\n          </el-empty>\r\n        </div>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      cartItems: []\r\n    }\r\n  },\r\n  computed: {\r\n    totalPrice() {\r\n      return this.cartItems.reduce((sum, item) => {\r\n        return sum + (item.book.price * item.quantity)\r\n      }, 0)\r\n    }\r\n  },\r\n  created() {\r\n    this.loadCart()\r\n  },\r\n  methods: {\r\n    async loadCart() {\r\n      try {\r\n        const { data } = await this.$axios.get(this.$httpUrl + '/cart/list')\r\n        if(data.code === 200) {\r\n          this.cartItems = data.data\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('获取购物车失败')\r\n      }\r\n    },\r\n    async handleQuantityChange(item) {\r\n      try {\r\n        const { data } = await this.$axios.put(\r\n            this.$httpUrl + `/cart/update?pid=${item.bookId}&num=${item.quantity}`\r\n        )\r\n        if(data.code !== 200) {\r\n          this.$message.error('更新失败')\r\n          this.loadCart() // 重新加载数据\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('更新失败')\r\n        this.loadCart()\r\n      }\r\n    },\r\n    async handleDelete(item) {\r\n      try {\r\n        await this.$axios.delete(\r\n            this.$httpUrl + `/cart/delete?pid=${item.bookId}`\r\n        )\r\n        this.$message.success('删除成功')\r\n        this.loadCart()\r\n      } catch (error) {\r\n        this.$message.error('删除失败')\r\n      }\r\n    },\r\n    handleCheckout() {\r\n      if(!this.checkLogin()) return\r\n      if(this.cartItems.length === 0) return\r\n      this.$router.push('/confirm')\r\n    },\r\n    checkLogin() {\r\n      if(!sessionStorage.getItem('CurUser')) {\r\n        this.$router.push('/login')\r\n        return false\r\n      }\r\n      return true\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.cart-container {\r\n  padding: 40px 0;\r\n  min-height: 600px;\r\n}\r\n.cart-title {\r\n  font-size: 28px;\r\n  color: #2b2f36;\r\n  margin-bottom: 30px;\r\n  padding-bottom: 15px;\r\n  border-bottom: 2px solid #eee;\r\n}\r\n\r\n.product-info {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.product-image {\r\n  width: 80px;\r\n  height: 100px;\r\n  margin-right: 20px;\r\n}\r\n.product-meta h3 {\r\n  margin: 0 0 8px;\r\n  font-size: 16px;\r\n}\r\n.product-meta .author {\r\n  color: #666;\r\n  font-size: 14px;\r\n}\r\n\r\n.summary {\r\n  margin-top: 30px;\r\n  text-align: right;\r\n  padding: 20px;\r\n  background: #f8f9fa;\r\n  border-radius: 8px;\r\n}\r\n.summary .total {\r\n  font-size: 24px;\r\n  color: #ff4444;\r\n  margin-bottom: 20px;\r\n  font-weight: bold;\r\n}\r\n\r\n.empty-cart {\r\n  margin-top: 100px;\r\n  text-align: center;\r\n}\r\n</style>\r\n"],"mappings":";;;AAoFA;EACAA,KAAA;IACA;MACAC,SAAA;IACA;EACA;EACAC,QAAA;IACAC,WAAA;MACA,YAAAF,SAAA,CAAAG,MAAA,EAAAC,GAAA,EAAAC,IAAA;QACA,OAAAD,GAAA,GAAAC,IAAA,CAAAC,IAAA,CAAAC,KAAA,GAAAF,IAAA,CAAAG,QAAA;MACA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,QAAA;EACA;EACAC,OAAA;IACA,MAAAD,SAAA;MACA;QACA;UAAAX;QAAA,eAAAa,MAAA,CAAAC,GAAA,MAAAC,QAAA;QACA,IAAAf,IAAA,CAAAgB,IAAA;UACA,KAAAf,SAAA,GAAAD,IAAA,CAAAA,IAAA;QACA;MACA,SAAAiB,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;IACA;IACA,MAAAE,qBAAAb,IAAA;MACA;QACA;UAAAN;QAAA,eAAAa,MAAA,CAAAO,GAAA,CACA,KAAAL,QAAA,uBAAAT,IAAA,CAAAe,MAAA,QAAAf,IAAA,CAAAG,QAAA,EACA;QACA,IAAAT,IAAA,CAAAgB,IAAA;UACA,KAAAE,QAAA,CAAAD,KAAA;UACA,KAAAN,QAAA;QACA;MACA,SAAAM,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;QACA,KAAAN,QAAA;MACA;IACA;IACA,MAAAW,aAAAhB,IAAA;MACA;QACA,WAAAO,MAAA,CAAAU,MAAA,CACA,KAAAR,QAAA,uBAAAT,IAAA,CAAAe,MAAA,EACA;QACA,KAAAH,QAAA,CAAAM,OAAA;QACA,KAAAb,QAAA;MACA,SAAAM,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;IACA;IACAQ,eAAA;MACA,UAAAC,UAAA;MACA,SAAAzB,SAAA,CAAA0B,MAAA;MACA,KAAAC,OAAA,CAAAC,IAAA;IACA;IACAH,WAAA;MACA,KAAAI,cAAA,CAAAC,OAAA;QACA,KAAAH,OAAA,CAAAC,IAAA;QACA;MACA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}