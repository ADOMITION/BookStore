{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { formatDate } from '@/store/formatDate';\nexport default {\n  name: 'OrderDetail',\n  data() {\n    return {\n      order: {\n        id: null,\n        items: [],\n        status: '',\n        totalAmount: 0,\n        createtime: '',\n        address: '',\n        recipient: '',\n        tel: ''\n      },\n      payTime: null,\n      // 从接口获取实际支付时间\n      loading: false,\n      refundDeadline: 3 // 退款有效期天数\n    };\n  },\n  computed: {\n    statusTagType() {\n      return status => {\n        const map = {\n          '待付款': 'warning',\n          '已付款': 'success',\n          '已完成': 'info',\n          '已取消': 'danger'\n        };\n        return map[status] || 'info';\n      };\n    },\n    //显示退款按钮条件\n    showRefundButton() {\n      return this.order.status === '已付款' && this.remainingRefundTime !== '已过期';\n    },\n    // 计算剩余退款时间\n    remainingRefundTime() {\n      //参数检查：若支付时间不存在，直接返回 null（无有效数据可计算）\n      if (!this.payTime) return null;\n\n      //初始化支付时间对象（将存储的支付时间转为 Date 类型）\n      const payDate = new Date(this.payTime);\n      //计算退款截止日期：支付时间 + 退款期限天数（3天）\n      //`setDate`方法会修改原日期对象并返回毫秒时间戳，重新创建Date对象确保正确性\n      const deadline = new Date(payDate.setDate(payDate.getDate() + this.refundDeadline));\n      const now = new Date();\n      // 时间比较：若当前时间超过截止日期，说明退款已过期\n      if (now > deadline) return '已过期';\n      const diff = deadline - now;\n      //Math.floor 向下取整，避免出现小数\n      const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n      //计算剩余小时数：先取模得到不足一天的毫秒数，再除以一小时的毫秒数\n      const hours = Math.floor(diff % (1000 * 60 * 60 * 24) / (1000 * 60 * 60));\n      return `${days}天${hours}小时`;\n    }\n  },\n  created() {\n    this.loadOrderDetail();\n  },\n  methods: {\n    formatTime(time) {\n      return formatDate(new Date(time), 'yyyy-MM-dd hh:mm:ss');\n    },\n    async loadOrderDetail() {\n      const orderId = this.$route.params.oid;\n      try {\n        const {\n          data\n        } = await this.$axios.get(`${this.$httpUrl}/order/detail/${orderId}`);\n        if (data.code === 200) {\n          this.order = data.data;\n          // 模拟支付时间\n          this.payTime = new Date().toISOString();\n        }\n      } catch (error) {\n        this.$message.error('获取订单详情失败');\n      }\n    },\n    async handleCancel() {\n      this.$confirm('确定要取消此订单吗？', '提示', {\n        type: 'warning'\n      }).then(async () => {\n        this.loading = true;\n        try {\n          const {\n            data\n          } = await this.$axios.post(`${this.$httpUrl}/order/cancel`, {\n            oid: this.order.id\n          });\n          if (data.code === 200) {\n            this.order.status = '已取消';\n            this.$message.success('订单已取消');\n          }\n        } finally {\n          this.loading = false;\n        }\n      });\n    },\n    async handleRefund() {\n      this.$confirm('确定要申请退款吗？', '提示', {\n        type: 'warning'\n      }).then(async () => {\n        this.loading = true;\n        try {\n          // 模拟退款接口\n          const {\n            data\n          } = await this.$axios.post(`${this.$httpUrl}/order/refund`, {\n            oid: this.order.id\n          });\n          if (data.code === 200) {\n            this.order.status = '已取消';\n            this.$message.success('退款申请已提交');\n          }\n        } finally {\n          this.loading = false;\n        }\n      });\n    },\n    handlePay() {\n      this.$router.push({\n        path: '/pay',\n        query: {\n          oid: this.order.id,\n          total: this.order.totalAmount\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["formatDate","name","data","order","id","items","status","totalAmount","createtime","address","recipient","tel","payTime","loading","refundDeadline","computed","statusTagType","map","showRefundButton","remainingRefundTime","payDate","Date","deadline","setDate","getDate","now","diff","days","Math","floor","hours","created","loadOrderDetail","methods","formatTime","time","orderId","$route","params","oid","$axios","get","$httpUrl","code","toISOString","error","$message","handleCancel","$confirm","type","then","post","success","handleRefund","handlePay","$router","push","path","query","total"],"sources":["src/user/OrderDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"detail-container\">\r\n    <el-card class=\"order-card\">\r\n      <!-- 订单基本信息 -->\r\n      <div class=\"order-header\">\r\n        <h2>订单号：{{ order.id }}</h2>\r\n        <el-tag :type=\"statusTagType(order.status)\" size=\"medium\">\r\n          {{ order.status }}\r\n        </el-tag>\r\n      </div>\r\n\r\n      <!-- 商品信息 -->\r\n      <el-divider content-position=\"left\">商品信息</el-divider>\r\n      <el-table :data=\"order.items\" border>\r\n        <el-table-column label=\"商品封面\" width=\"120\" align=\"center\">\r\n          <template slot-scope=\"{row}\">\r\n            <el-image\r\n                :src=\"row.book.url || require('@/assets/default-book.png')\"\r\n                class=\"book-cover\"\r\n            ></el-image>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"book.name\" label=\"书名\"></el-table-column>\r\n        <el-table-column label=\"单价\" width=\"120\" align=\"center\">\r\n          <template slot-scope=\"{row}\">\r\n            ¥{{ row.price.toFixed(2) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"quantity\" label=\"数量\" width=\"100\" align=\"center\"></el-table-column>\r\n        <el-table-column label=\"小计\" width=\"120\" align=\"center\">\r\n          <template slot-scope=\"{row}\">\r\n            ¥{{ (row.price * row.quantity).toFixed(2) }}\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!-- 金额汇总 -->\r\n      <div class=\"amount-summary\">\r\n        <div class=\"total-line\">\r\n          <span>商品总价：</span>\r\n          <span>¥{{ order.totalAmount.toFixed(2) }}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 订单信息 -->\r\n      <el-divider content-position=\"left\">订单信息</el-divider>\r\n      <div class=\"order-info\">\r\n        <div class=\"info-item\">\r\n          <label>下单时间：</label>\r\n          <span>{{ formatTime(order.createtime) }}</span>\r\n        </div>\r\n        <div class=\"info-item\" v-if=\"order.status === '已付款'\">\r\n          <label>支付时间：</label>\r\n          <span>{{ formatTime(payTime) }}</span>\r\n          <span v-if=\"remainingRefundTime\" class=\"refund-tip\">\r\n            （剩余退款时间：{{ remainingRefundTime }}）\r\n          </span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <label>收货地址：</label>\r\n          <span>{{ order.address }}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <label>收件人：</label>\r\n          <span>{{ order.recipient }}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <label>联系方式：</label>\r\n          <span>{{ order.tel }}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 操作按钮 -->\r\n      <div class=\"action-buttons\">\r\n        <el-button\r\n            v-if=\"order.status === '待付款'\"\r\n            type=\"primary\"\r\n            @click=\"handlePay\"\r\n            :loading=\"loading\"\r\n        >\r\n          立即支付\r\n        </el-button>\r\n        <el-button\r\n            v-if=\"order.status === '待付款'\"\r\n            type=\"danger\"\r\n            @click=\"handleCancel\"\r\n            :loading=\"loading\"\r\n        >\r\n          取消订单\r\n        </el-button>\r\n\r\n        <el-button\r\n            v-if=\"showRefundButton\"\r\n            type=\"warning\"\r\n            @click=\"handleRefund\"\r\n            :loading=\"loading\"\r\n        >\r\n          申请退款\r\n        </el-button>\r\n\r\n        <el-button @click=\"$router.go(-1)\">返回列表</el-button>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { formatDate } from '@/store/formatDate';\r\n\r\nexport default {\r\n  name: 'OrderDetail',\r\n  data() {\r\n    return {\r\n      order: {\r\n        id: null,\r\n        items: [],\r\n        status: '',\r\n        totalAmount: 0,\r\n        createtime: '',\r\n        address: '',\r\n        recipient: '',\r\n        tel: ''\r\n      },\r\n      payTime: null,       // 从接口获取实际支付时间\r\n      loading: false,\r\n      refundDeadline: 3    // 退款有效期天数\r\n    }\r\n  },\r\n  computed: {\r\n    statusTagType() {\r\n      return (status) => {\r\n        const map = {\r\n          '待付款': 'warning',\r\n          '已付款': 'success',\r\n          '已完成': 'info',\r\n          '已取消': 'danger'\r\n        }\r\n        return map[status] || 'info';\r\n      }\r\n    },\r\n\r\n    //显示退款按钮条件\r\n    showRefundButton() {\r\n      return this.order.status === '已付款' && this.remainingRefundTime !== '已过期'\r\n    },\r\n\r\n    // 计算剩余退款时间\r\n    remainingRefundTime() {\r\n      //参数检查：若支付时间不存在，直接返回 null（无有效数据可计算）\r\n      if (!this.payTime) return null\r\n\r\n      //初始化支付时间对象（将存储的支付时间转为 Date 类型）\r\n      const payDate = new Date(this.payTime)\r\n      //计算退款截止日期：支付时间 + 退款期限天数（3天）\r\n      //`setDate`方法会修改原日期对象并返回毫秒时间戳，重新创建Date对象确保正确性\r\n      const deadline = new Date(payDate.setDate(payDate.getDate() + this.refundDeadline))\r\n      const now = new Date()\r\n      // 时间比较：若当前时间超过截止日期，说明退款已过期\r\n      if (now > deadline) return '已过期'\r\n      const diff = deadline - now\r\n      //Math.floor 向下取整，避免出现小数\r\n      const days = Math.floor(diff / (1000 * 60 * 60 * 24))\r\n      //计算剩余小时数：先取模得到不足一天的毫秒数，再除以一小时的毫秒数\r\n      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))\r\n      return `${days}天${hours}小时`\r\n    }\r\n  },\r\n  created() {\r\n    this.loadOrderDetail()\r\n  },\r\n  methods: {\r\n    formatTime(time) {\r\n      return formatDate(new Date(time), 'yyyy-MM-dd hh:mm:ss')\r\n    },\r\n\r\n    async loadOrderDetail() {\r\n      const orderId = this.$route.params.oid\r\n      try {\r\n        const { data } = await this.$axios.get(`${this.$httpUrl}/order/detail/${orderId}`)\r\n        if (data.code === 200) {\r\n          this.order = data.data\r\n          // 模拟支付时间\r\n          this.payTime = new Date().toISOString()\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('获取订单详情失败')\r\n      }\r\n    },\r\n\r\n    async handleCancel() {\r\n      this.$confirm('确定要取消此订单吗？', '提示', {\r\n        type: 'warning'\r\n      }).then(async () => {\r\n        this.loading = true\r\n        try {\r\n          const { data } = await this.$axios.post(`${this.$httpUrl}/order/cancel`, {\r\n            oid: this.order.id\r\n          })\r\n          if (data.code === 200) {\r\n            this.order.status = '已取消'\r\n            this.$message.success('订单已取消')\r\n          }\r\n        } finally {\r\n          this.loading = false\r\n        }\r\n      })\r\n    },\r\n\r\n    async handleRefund() {\r\n      this.$confirm('确定要申请退款吗？', '提示', {\r\n        type: 'warning'\r\n      }).then(async () => {\r\n        this.loading = true\r\n        try {\r\n          // 模拟退款接口\r\n          const { data } = await this.$axios.post(`${this.$httpUrl}/order/refund`, {\r\n            oid: this.order.id\r\n          })\r\n          if (data.code === 200) {\r\n            this.order.status = '已取消'\r\n            this.$message.success('退款申请已提交')\r\n          }\r\n        } finally {\r\n          this.loading = false\r\n        }\r\n      })\r\n    },\r\n    handlePay() {\r\n      this.$router.push({\r\n        path: '/pay',\r\n        query: {\r\n          oid: this.order.id,\r\n          total: this.order.totalAmount\r\n        }\r\n      });\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.detail-container {\r\n  padding: 20px;\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.order-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.book-cover {\r\n  width: 60px;\r\n  height: 80px;\r\n}\r\n\r\n.amount-summary {\r\n  margin: 20px 0;\r\n  text-align: right;\r\n  padding: 10px;\r\n  background: #f5f7fa;\r\n}\r\n\r\n.total-line {\r\n  font-size: 16px;\r\n  margin: 10px 0;\r\n}\r\n\r\n.order-info {\r\n  padding: 0 20px;\r\n}\r\n\r\n.info-item {\r\n  margin: 12px 0;\r\n  font-size: 14px;\r\n}\r\n\r\n.info-item label {\r\n  display: inline-block;\r\n  width: 100px;\r\n  color: #909399;\r\n}\r\n\r\n.refund-tip {\r\n  color: #e6a23c;\r\n  margin-left: 10px;\r\n}\r\n\r\n.action-buttons {\r\n  margin-top: 30px;\r\n  text-align: center;\r\n}\r\n</style>"],"mappings":";AA2GA,SAAAA,UAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,KAAA;QACAC,EAAA;QACAC,KAAA;QACAC,MAAA;QACAC,WAAA;QACAC,UAAA;QACAC,OAAA;QACAC,SAAA;QACAC,GAAA;MACA;MACAC,OAAA;MAAA;MACAC,OAAA;MACAC,cAAA;IACA;EACA;EACAC,QAAA;IACAC,cAAA;MACA,OAAAV,MAAA;QACA,MAAAW,GAAA;UACA;UACA;UACA;UACA;QACA;QACA,OAAAA,GAAA,CAAAX,MAAA;MACA;IACA;IAEA;IACAY,iBAAA;MACA,YAAAf,KAAA,CAAAG,MAAA,mBAAAa,mBAAA;IACA;IAEA;IACAA,oBAAA;MACA;MACA,UAAAP,OAAA;;MAEA;MACA,MAAAQ,OAAA,OAAAC,IAAA,MAAAT,OAAA;MACA;MACA;MACA,MAAAU,QAAA,OAAAD,IAAA,CAAAD,OAAA,CAAAG,OAAA,CAAAH,OAAA,CAAAI,OAAA,UAAAV,cAAA;MACA,MAAAW,GAAA,OAAAJ,IAAA;MACA;MACA,IAAAI,GAAA,GAAAH,QAAA;MACA,MAAAI,IAAA,GAAAJ,QAAA,GAAAG,GAAA;MACA;MACA,MAAAE,IAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAH,IAAA;MACA;MACA,MAAAI,KAAA,GAAAF,IAAA,CAAAC,KAAA,CAAAH,IAAA;MACA,UAAAC,IAAA,IAAAG,KAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,eAAA;EACA;EACAC,OAAA;IACAC,WAAAC,IAAA;MACA,OAAAnC,UAAA,KAAAqB,IAAA,CAAAc,IAAA;IACA;IAEA,MAAAH,gBAAA;MACA,MAAAI,OAAA,QAAAC,MAAA,CAAAC,MAAA,CAAAC,GAAA;MACA;QACA;UAAArC;QAAA,eAAAsC,MAAA,CAAAC,GAAA,SAAAC,QAAA,iBAAAN,OAAA;QACA,IAAAlC,IAAA,CAAAyC,IAAA;UACA,KAAAxC,KAAA,GAAAD,IAAA,CAAAA,IAAA;UACA;UACA,KAAAU,OAAA,OAAAS,IAAA,GAAAuB,WAAA;QACA;MACA,SAAAC,KAAA;QACA,KAAAC,QAAA,CAAAD,KAAA;MACA;IACA;IAEA,MAAAE,aAAA;MACA,KAAAC,QAAA;QACAC,IAAA;MACA,GAAAC,IAAA;QACA,KAAArC,OAAA;QACA;UACA;YAAAX;UAAA,eAAAsC,MAAA,CAAAW,IAAA,SAAAT,QAAA;YACAH,GAAA,OAAApC,KAAA,CAAAC;UACA;UACA,IAAAF,IAAA,CAAAyC,IAAA;YACA,KAAAxC,KAAA,CAAAG,MAAA;YACA,KAAAwC,QAAA,CAAAM,OAAA;UACA;QACA;UACA,KAAAvC,OAAA;QACA;MACA;IACA;IAEA,MAAAwC,aAAA;MACA,KAAAL,QAAA;QACAC,IAAA;MACA,GAAAC,IAAA;QACA,KAAArC,OAAA;QACA;UACA;UACA;YAAAX;UAAA,eAAAsC,MAAA,CAAAW,IAAA,SAAAT,QAAA;YACAH,GAAA,OAAApC,KAAA,CAAAC;UACA;UACA,IAAAF,IAAA,CAAAyC,IAAA;YACA,KAAAxC,KAAA,CAAAG,MAAA;YACA,KAAAwC,QAAA,CAAAM,OAAA;UACA;QACA;UACA,KAAAvC,OAAA;QACA;MACA;IACA;IACAyC,UAAA;MACA,KAAAC,OAAA,CAAAC,IAAA;QACAC,IAAA;QACAC,KAAA;UACAnB,GAAA,OAAApC,KAAA,CAAAC,EAAA;UACAuD,KAAA,OAAAxD,KAAA,CAAAI;QACA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}