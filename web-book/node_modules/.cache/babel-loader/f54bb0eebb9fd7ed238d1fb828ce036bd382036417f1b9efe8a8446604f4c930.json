{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nexport default {\n  data() {\n    // 手机号验证规则\n    const validatePhone = (rule, value, callback) => {\n      if (!/^1[3-9]\\d{9}$/.test(value)) {\n        callback(new Error('请输入正确的手机号码'));\n      } else {\n        callback();\n      }\n    };\n    return {\n      loading: false,\n      submitting: false,\n      confirmData: {\n        items: [],\n        total: 0\n      },\n      form: {\n        address: '',\n        recipient: '',\n        tel: ''\n      },\n      rules: {\n        address: [{\n          required: true,\n          message: '请输入收货地址',\n          trigger: 'blur'\n        }],\n        recipient: [{\n          required: true,\n          message: '请输入收件人姓名',\n          trigger: 'blur'\n        }],\n        tel: [{\n          required: true,\n          message: '请输入联系方式',\n          trigger: 'blur'\n        }, {\n          validator: validatePhone,\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: {\n    originalTotal() {\n      return this.confirmData.items.reduce((sum, item) => {\n        return sum + item.originalPrice * item.orderItem.quantity;\n      }, 0);\n    },\n    discountAmount() {\n      return this.originalTotal - this.confirmData.total;\n    }\n  },\n  created() {\n    this.loadConfirmData();\n  },\n  methods: {\n    async loadConfirmData() {\n      this.loading = true;\n      try {\n        if (this.$route.query.type === 'batch') {\n          // 处理批量订单\n          const oiids = JSON.parse(this.$route.query.oiids);\n          const {\n            data\n          } = await this.$axios.get(`${this.$httpUrl}/order/batchConfirm`, {\n            params: {\n              oiids\n            },\n            paramsSerializer: params => {\n              return qs.stringify(params, {\n                arrayFormat: 'repeat'\n              });\n            }\n          });\n          this.confirmData = data.data;\n        } else {\n          // 处理单个订单项\n          const oiid = this.$route.query.oiid;\n          const {\n            data\n          } = await this.$axios.get(`${this.$httpUrl}/order/confirm`, {\n            params: {\n              oiid\n            }\n          });\n          this.confirmData = {\n            items: [data.data],\n            total: data.data.discountPrice * data.data.orderItem.quantity\n          };\n        }\n      } catch (error) {\n        this.$message.error('获取订单信息失败');\n      } finally {\n        this.loading = false;\n      }\n    },\n    calculateDiscountTag(stock) {\n      if (stock > 25) return '七折';\n      if (stock >= 20) return '八折';\n      if (stock >= 15) return '九折';\n      return '';\n    },\n    async handleSubmit() {\n      try {\n        this.submitting = true;\n        const params = {\n          ...this.form,\n          oiids: this.confirmData.items.map(item => item.orderItem.id)\n        };\n        const {\n          data\n        } = await this.$axios.post(this.$httpUrl + '/order/createBatch', params);\n        if (data.code === 200) {\n          this.$router.push({\n            path: '/pay',\n            query: {\n              oid: data.data.oid,\n              total: data.data.total\n            }\n          });\n        }\n      } catch (error) {\n        this.$message.error('提交订单失败');\n      } finally {\n        this.submitting = false;\n      }\n    }\n  }\n};","map":{"version":3,"names":["data","validatePhone","rule","value","callback","test","Error","loading","submitting","confirmData","items","total","form","address","recipient","tel","rules","required","message","trigger","validator","computed","originalTotal","reduce","sum","item","originalPrice","orderItem","quantity","discountAmount","created","loadConfirmData","methods","$route","query","type","oiids","JSON","parse","$axios","get","$httpUrl","params","paramsSerializer","qs","stringify","arrayFormat","oiid","discountPrice","error","$message","calculateDiscountTag","stock","handleSubmit","map","id","post","code","$router","push","path","oid"],"sources":["src/user/ConfirmPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"confirm-container\">\r\n    <!-- 头部导航 -->\r\n    <el-steps :active=\"2\" simple class=\"steps\">\r\n      <el-step title=\"首页\" icon=\"el-icon-location-outline\" ></el-step>\r\n      <el-step title=\"确认订单\" icon=\"el-icon-goods\" style=\"margin-right: -20px\"></el-step>\r\n      <el-step title=\"支付\" icon=\"el-icon-wallet\" ></el-step>\r\n      <el-step title=\"完成\" icon=\"el-icon-success\"></el-step>\r\n    </el-steps>\r\n\r\n    <!-- 主体内容 -->\r\n    <div class=\"main-content\">\r\n      <!-- 收货信息 -->\r\n      <el-card class=\"shipping-card\">\r\n        <div slot=\"header\" class=\"card-header\">\r\n          <i class=\"el-icon-location-outline\"></i>\r\n          <span>收货信息</span>\r\n        </div>\r\n        <el-form\r\n            :model=\"form\"\r\n            :rules=\"rules\"\r\n            ref=\"formRef\"\r\n            label-width=\"100px\"\r\n            class=\"shipping-form\"\r\n        >\r\n          <el-form-item label=\"收货地址\" prop=\"address\">\r\n            <el-input\r\n                v-model=\"form.address\"\r\n                placeholder=\"请输入详细地址\"\r\n                clearable\r\n            ></el-input>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"收件人\" prop=\"recipient\">\r\n            <el-input\r\n                v-model=\"form.recipient\"\r\n                placeholder=\"请输入收件人姓名\"\r\n                clearable\r\n            ></el-input>\r\n          </el-form-item>\r\n\r\n          <el-form-item label=\"联系方式\" prop=\"tel\">\r\n            <el-input\r\n                v-model=\"form.tel\"\r\n                placeholder=\"请输入手机号码\"\r\n                clearable\r\n            ></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n      </el-card>\r\n\r\n      <!-- 商品信息 -->\r\n      <el-card class=\"goods-card\">\r\n        <div slot=\"header\" class=\"card-header\">\r\n          <i class=\"el-icon-shopping-cart-2\"></i>\r\n          <span>商品信息</span>\r\n        </div>\r\n        <el-table\r\n            :data=\"confirmData.items\"\r\n            border\r\n            class=\"goods-table\"\r\n            v-loading=\"loading\"\r\n            element-loading-text=\"正在加载订单信息...\"\r\n            element-loading-spinner=\"el-icon-loading\"\r\n        >\r\n          <el-table-column label=\"商品信息\" width=\"400\">\r\n            <template slot-scope=\"{row}\">\r\n              <div class=\"goods-info\">\r\n                <el-image\r\n                    :src=\"row.book.url || require('@/assets/default-book.png')\"\r\n                    class=\"goods-image\"\r\n                ></el-image>\r\n                <div class=\"goods-desc\">\r\n                  <div class=\"name\">{{ row.book.name }}</div>\r\n                  <div class=\"author\">{{ row.book.author }}</div>\r\n                  <el-tag v-if=\"row.discountPrice.compareTo(row.originalPrice) !== 0\"\r\n                          type=\"success\" size=\"mini\">\r\n                    {{ calculateDiscountTag(row.book.stock) }}\r\n                  </el-tag>\r\n                </div>\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"原价\" align=\"center\" width=\"120\">\r\n            <template slot-scope=\"{row}\">\r\n              <span class=\"original-price\">\r\n                ¥{{ row.originalPrice.toFixed(2) }}\r\n              </span>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"折扣价\" align=\"center\" width=\"120\">\r\n            <template slot-scope=\"{row}\">\r\n              <span class=\"discount-price\">\r\n                ¥{{ row.discountPrice.toFixed(2) }}\r\n              </span>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"数量\" align=\"center\" width=\"120\">\r\n            <template slot-scope=\"{row}\">\r\n              {{ row.orderItem.quantity }}\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"小计\" align=\"center\" width=\"120\">\r\n            <template slot-scope=\"{row}\">\r\n              ¥{{ (row.discountPrice.multiply(\r\n                new BigDecimal(row.orderItem.quantity))).toFixed(2)\r\n              }}\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n\r\n        <!-- 空状态提示 -->\r\n        <div v-if=\"!loading && confirmData.items.length === 0\"\r\n             class=\"empty-container\">\r\n          <i class=\"el-icon-warning-outline\"></i>\r\n          <p>未找到商品信息</p>\r\n        </div>\r\n      </el-card>\r\n\r\n      <!-- 金额汇总 -->\r\n      <div class=\"total-section\">\r\n        <div class=\"price-summary\">\r\n          <div class=\"total-line\">\r\n            <span>商品总价：</span>\r\n            <span>¥{{ originalTotal.toFixed(2) }}</span>\r\n          </div>\r\n          <div class=\"total-line discount-line\"\r\n               v-if=\"discountAmount > 0\">\r\n            <span>折扣优惠：</span>\r\n            <span class=\"discount-amount\">-¥{{ discountAmount.toFixed(2) }}</span>\r\n          </div>\r\n          <div class=\"total-line grand-total\">\r\n            <span>应付总额：</span>\r\n            <span class=\"red-text\">¥{{ confirmData.total.toFixed(2) }}</span>\r\n          </div>\r\n        </div>\r\n        <el-button\r\n            type=\"danger\"\r\n            class=\"submit-btn\"\r\n            :loading=\"submitting\"\r\n            @click=\"handleSubmit\"\r\n        >\r\n          {{ submitting ? '提交中...' : '提交订单' }}\r\n        </el-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    // 手机号验证规则\r\n    const validatePhone = (rule, value, callback) => {\r\n      if (!/^1[3-9]\\d{9}$/.test(value)) {\r\n        callback(new Error('请输入正确的手机号码'));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    return {\r\n      loading:false,\r\n      submitting: false,\r\n      confirmData: {\r\n        items: [],\r\n        total: 0\r\n      },\r\n      form: {\r\n        address: '',\r\n        recipient: '',\r\n        tel: ''\r\n      },\r\n      rules: {\r\n        address: [\r\n          { required: true, message: '请输入收货地址', trigger: 'blur' }\r\n        ],\r\n        recipient: [\r\n          { required: true, message: '请输入收件人姓名', trigger: 'blur' }\r\n        ],\r\n        tel: [\r\n          { required: true, message: '请输入联系方式', trigger: 'blur' },\r\n          { validator: validatePhone, trigger: 'blur' }\r\n        ]\r\n      },\r\n    };\r\n  },\r\n  computed: {\r\n    originalTotal() {\r\n      return this.confirmData.items.reduce((sum, item) => {\r\n        return sum + (item.originalPrice * item.orderItem.quantity);\r\n      }, 0);\r\n    },\r\n    discountAmount() {\r\n      return this.originalTotal - this.confirmData.total;\r\n    }\r\n  },\r\n  created() {\r\n    this.loadConfirmData();\r\n  },\r\n  methods: {\r\n    async loadConfirmData() {\r\n      this.loading = true;\r\n      try {\r\n        if (this.$route.query.type === 'batch') {\r\n          // 处理批量订单\r\n          const oiids = JSON.parse(this.$route.query.oiids);\r\n          const { data } = await this.$axios.get(\r\n              `${this.$httpUrl}/order/batchConfirm`, {\r\n                params: { oiids },\r\n                paramsSerializer: params => {\r\n                  return qs.stringify(params, { arrayFormat: 'repeat' })\r\n                }\r\n              }\r\n          );\r\n          this.confirmData = data.data;\r\n        } else {\r\n          // 处理单个订单项\r\n          const oiid = this.$route.query.oiid;\r\n          const { data } = await this.$axios.get(\r\n              `${this.$httpUrl}/order/confirm`,\r\n              { params: { oiid } }\r\n          );\r\n          this.confirmData = {\r\n            items: [data.data],\r\n            total: data.data.discountPrice * data.data.orderItem.quantity\r\n          };\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('获取订单信息失败');\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n    calculateDiscountTag(stock) {\r\n      if (stock > 25) return '七折';\r\n      if (stock >= 20) return '八折';\r\n      if (stock >= 15) return '九折';\r\n      return '';\r\n    },\r\n\r\n    async handleSubmit() {\r\n      try {\r\n        this.submitting = true;\r\n        const params = {\r\n          ...this.form,\r\n          oiids: this.confirmData.items.map(item => item.orderItem.id)\r\n        };\r\n\r\n        const {data} = await this.$axios.post(\r\n            this.$httpUrl + '/order/createBatch',\r\n            params\r\n        );\r\n        if (data.code === 200) {\r\n          this.$router.push({\r\n            path: '/pay',\r\n            query: {\r\n              oid: data.data.oid,\r\n              total: data.data.total\r\n            }\r\n          });\r\n        }\r\n      } catch (error) {\r\n        this.$message.error('提交订单失败');\r\n      }finally {\r\n        this.submitting = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.confirm-container {\r\n  padding: 20px 200px;\r\n  background: #f5f5f5;\r\n}\r\n\r\n.steps {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.main-content {\r\n  background: white;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n}\r\n\r\n.card-header {\r\n  font-size: 18px;\r\n  color: #333;\r\n}\r\n\r\n.card-header i {\r\n  margin-right: 8px;\r\n  color: #409EFF;\r\n}\r\n\r\n.shipping-form {\r\n  padding: 0 50px;\r\n}\r\n\r\n.goods-info {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.goods-image {\r\n  width: 60px;\r\n  height: 80px;\r\n  margin-right: 15px;\r\n}\r\n\r\n.goods-desc .name {\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.goods-desc .author {\r\n  color: #666;\r\n  font-size: 12px;\r\n}\r\n\r\n.original-price {\r\n  text-decoration: line-through;\r\n  color: #999;\r\n}\r\n\r\n.discount-price {\r\n  color: #f56c6c;\r\n  font-weight: bold;\r\n}\r\n\r\n.total-section {\r\n  margin-top: 30px;\r\n  text-align: right;\r\n  padding: 20px;\r\n  background: #fafafa;\r\n  border-radius: 4px;\r\n}\r\n\r\n.total-line {\r\n  margin: 10px 0;\r\n  font-size: 14px;\r\n}\r\n\r\n.grand-total {\r\n  font-size: 18px;\r\n  margin-top: 20px;\r\n}\r\n\r\n.red-text {\r\n  color: #f56c6c;\r\n  font-weight: bold;\r\n  font-size: 24px;\r\n}\r\n\r\n.submit-btn {\r\n  margin-top: 20px;\r\n  width: 200px;\r\n  height: 50px;\r\n  font-size: 18px;\r\n}\r\n.empty-container {\r\n  padding: 40px;\r\n  text-align: center;\r\n  color: #999;\r\n}\r\n.empty-container i {\r\n  font-size: 40px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.price-summary {\r\n  text-align: right;\r\n  padding: 0 20px;\r\n}\r\n\r\n.total-line {\r\n  margin: 8px 0;\r\n  font-size: 14px;\r\n}\r\n\r\n.discount-line {\r\n  color: #67C23A;\r\n}\r\n\r\n.discount-amount {\r\n  font-weight: bold;\r\n}\r\n\r\n.grand-total {\r\n  font-size: 16px;\r\n  margin-top: 12px;\r\n}\r\n\r\n.red-text {\r\n  color: #f56c6c;\r\n  font-size: 18px;\r\n}\r\n\r\n.submit-btn {\r\n  margin-top: 20px;\r\n  width: 200px;\r\n  height: 50px;\r\n  font-size: 16px;\r\n}\r\n\r\n/* 调整图片尺寸 */\r\n.goods-image {\r\n  width: 60px;\r\n  height: 80px;\r\n  margin-right: 15px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}